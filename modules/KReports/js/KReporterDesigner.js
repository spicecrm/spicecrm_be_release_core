/* * *******************************************************************************
* This file is part of SpiceCRM FulltextSearch. SpiceCRM FulltextSearch is an enhancement developed
* by aac services k.s.. All rights are (c) 2016 by aac services k.s.
*
* This Version of the SpiceCRM FulltextSearch is licensed software and may only be used in
* alignment with the License Agreement received with this Software.
* This Software is copyrighted and may not be further distributed without
* witten consent of aac services k.s.
*
* You can contact us at info@spicecrm.io
******************************************************************************* */

Ext.define("SpiceCRM.KReporter.Designer.model.bucket",{extend:"Ext.data.Model",fields:["id","name","modulename","fieldname"]}),Ext.define("SpiceCRM.KReporter.Designer.model.category",{extend:"Ext.data.Model",fields:["id","name","priority","is_admin_only"]}),Ext.define("SpiceCRM.KReporter.Designer.model.dlist",{extend:"Ext.data.Model",fields:["id","name"]}),Ext.define("SpiceCRM.KReporter.Designer.model.fields",{extend:"Ext.data.Model",alias:["widget.fieldsModel"],fields:["name","text","type"]}),Ext.define("SpiceCRM.KReporter.Designer.model.korgs",{extend:"Ext.data.Model",fields:["id","name"]}),Ext.define("SpiceCRM.KReporter.Designer.model.KReporterRecord",{extend:"Ext.data.Model",fields:["id","name","listtype","report_module","listfields","listtypeproperties","presentation_params","integration_params","visualization_params","reportoptions","union_modules","unionlistfields","team_id","team_name","securitygroup_id","securitygroup_name","category_id","category_priority"]}),Ext.define("SpiceCRM.KReporter.Designer.model.language",{extend:"Ext.data.Model",alias:["widget.languageModel"],fields:["lblid","value"]}),Ext.define("SpiceCRM.KReporter.Designer.model.layout",{extend:"Ext.data.Model",fields:["name","count"]}),Ext.define("SpiceCRM.KReporter.Designer.model.listFields",{extend:"Ext.data.Model",alias:["widget.KReportDesignerListFieldsModel"],fields:[{name:"fieldid",mapping:"fieldid"},{name:"sequence",mapping:"sequence"},{name:"fieldname",mapping:"fieldname"},{name:"name",mapping:"name"},{name:"display",mapping:"display"},{name:"path",mapping:"path"},{name:"displaypath",mapping:"displaypath"},{name:"sort",mapping:"sort"},{name:"sortpriority",mapping:"sortpriority"},{name:"width",mapping:"width"},{name:"jointype",mapping:"jointype"},{name:"sqlfunction",mapping:"sqlfunction"},{name:"summaryfunction",mapping:"summaryfunction"},{name:"customsqlfunction",mapping:"customsqlfunction"},{name:"valuetype",mapping:"valuetype"},{name:"groupby",mapping:"groupby"},{name:"link",mapping:"link"},{name:"editable",mapping:"editable"},{name:"fixedvalue",mapping:"fixedvalue"},{name:"assigntovalue",mapping:"assigntovalue"},{name:"formulavalue",mapping:"formulavalue"},{name:"formulasequence",mapping:"formulasequence"},{name:"widget",mapping:"widget"},{name:"overridetype",mapping:"overridetype"},{name:"overridealignment",mapping:"overridealignment"},{name:"grouping",mapping:"grouping"}]}),Ext.define("SpiceCRM.KReporter.Designer.view.main.MainModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.main",data:{name:"KReportDesigner"}}),Ext.define("SpiceCRM.KReporter.Designer.model.modules",{extend:"Ext.data.Model",alias:["widget.modulesModel"],fields:["module","name"]}),Ext.define("SpiceCRM.KReporter.Designer.model.moduletree",{extend:"Ext.data.TreeModel",fields:["module","path","name","link","id"],getPath:function(){for(var e="",t=this,i="";t.parentNode;)e=t.get("path")+(""!==e?"::"+e:""),t.get("path")&&(i=t.get("module")+(""!==i?"->"+i:"")),t=t.parentNode;return{path:e,displayPath:i}}}),Ext.define("SpiceCRM.KReporter.Designer.model.plugin",{extend:"Ext.data.Model",alias:["widget.pluginModel"],fields:["id","name","panel","active","loaded","plugindirectory","include"]}),Ext.define("SpiceCRM.KReporter.Designer.model.securitygroups",{extend:"Ext.data.Model",fields:["id","name"]}),Ext.define("SpiceCRM.KReporter.Designer.model.teams",{extend:"Ext.data.Model",fields:["id","name"]}),Ext.define("SpiceCRM.KReporter.Designer.model.unionListField",{extend:"Ext.data.Model",fields:[{name:"joinid",mapping:"joinid"},{name:"fieldid",mapping:"fieldid"},{name:"sequence",mapping:"sequence"},{name:"name",mapping:"name"},{name:"unionfieldpath",mapping:"unionfieldpath"},{name:"unionfielddisplaypath",mapping:"unionfielddisplaypath"},{name:"unionfieldname",mapping:"unionfieldname"},{name:"path",mapping:"path"},{name:"displaypath",mapping:"displaypath"},{name:"fixedvalue",mapping:"fixedvalue"}]}),Ext.define("SpiceCRM.KReporter.Designer.model.unionMappingPopupField",{extend:"Ext.data.Model",fields:[{name:"fieldid",mapping:"fieldid"},{name:"name",mapping:"name"},{name:"unionfielddisplaypath",mapping:"unionfielddisplaypath"},{name:"unionfieldname",mapping:"unionfieldname"}]}),Ext.define("SpiceCRM.KReporter.Designer.model.unionModule",{extend:"Ext.data.TreeModel",fields:["unionid","id","module","name","path"],getPath:function(){for(var e="",t=this,i="";t.parentNode;)e=t.get("path")+(""!==e?"::"+e:""),t.get("path")&&(i=t.get("module")+(""!==i?"->"+i:"")),t=t.parentNode;return{path:e,displayPath:i}}}),Ext.define("SpiceCRM.KReporter.Designer.model.users",{extend:"Ext.data.Model",alias:["widget.usersModel"],fields:["id","user_name","name"]}),Ext.define("SpiceCRM.KReporter.Designer.model.vizColor",{extend:"Ext.data.Model",fields:["id","name","colors"]}),Ext.define("SpiceCRM.KReporter.Designer.model.whereclause",{extend:"Ext.data.Model",fields:["unionid","sequence","fieldid","name","fixedvalue","groupid","path","grouping","displaypath","referencefieldid","operator","type","value","valuekey","valueto","valuetokey","jointype","context","reference","include","usereditable","dashleteditable","exportpdf","customsqlfunction"]}),Ext.define("SpiceCRM.KReporter.Designer.model.wheregroup",{extend:"Ext.data.Model",fields:["unionid","id","group","type","parent","notexists"]}),Ext.define("SpiceCRM.KReporter.Designer.model.wheretreeitem",{extend:"Ext.data.TreeModel",fields:["id","groupid","group","type"]}),Ext.define("SpiceCRM.KReporter.Designer.store.buckets",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.bucket"],model:"SpiceCRM.KReporter.Designer.model.bucket",isloaded:!1,proxy:{type:"ajax",url:"KREST/KReporter/bucketmanager/groupings",reader:{type:"json"}},autoLoad:!0}),Ext.define("SpiceCRM.KReporter.Designer.store.categories",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.category"],model:"SpiceCRM.KReporter.Designer.model.category",alias:"store.KReportDesignerCategories",proxy:{type:"ajax",url:"KREST/KReporter/categoriesmanager/categories",reader:{type:"json",rootProperty:"list",totalProperty:"totalcount"},extraParams:{fields:Ext.encode(["id","name"]),searchtermfields:Ext.encode(["name"]),addBlank:!0}}}),Ext.define("SpiceCRM.KReporter.Designer.store.dlists",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.dlist"],model:"SpiceCRM.KReporter.Designer.model.dlist",storeId:"KReportDesignerDListsStore",proxy:{type:"ajax",url:"KREST/KReporter/dlistmanager/dlists",reader:{type:"json"}},autoLoad:!0}),Ext.define("SpiceCRM.KReporter.Designer.store.fields",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.fields"],model:"SpiceCRM.KReporter.Designer.model.fields",proxy:{type:"ajax",url:"KREST/KReporter/core/fields",extraParams:{nodeid:""},reader:{type:"json"}},autoLoad:!1,listeners:{beforeload:function(e,t,i){return""!==e.getProxy().extraParams.nodeid}}}),Ext.define("SpiceCRM.KReporter.Designer.store.korgs",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.korgs"],model:"SpiceCRM.KReporter.Designer.model.korgs",alias:"store.KReportDesignerKOrgs",proxy:{type:"ajax",url:"KREST/korgobjects/core/orgobjects/module/KReport",reader:{type:"json",rootProperty:"items",totalProperty:"total"},extraParams:{fields:Ext.encode(["id","name"]),searchtermfields:Ext.encode(["name"])}}}),Ext.define("SpiceCRM.KReporter.Designer.reader.languageReader",{extend:"Ext.data.reader.Json",alias:"reader.languageReader",getResponseData:function(e){var i=[];return Ext.Object.each(this.callParent([e]),function(e,t){i.push({lblid:e,value:t})}),i}}),Ext.define("SpiceCRM.KReporter.Designer.store.language",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.language","SpiceCRM.KReporter.Designer.reader.languageReader"],model:"SpiceCRM.KReporter.Designer.model.language",isloaded:!1,proxy:{type:"ajax",url:"KREST/metadata/KReports/language",reader:{type:"languageReader"}},listeners:{load:function(){this.isloaded=!0,Ext.globalEvents.fireEvent("languageloaded")}}}),Ext.define("SpiceCRM.KReporter.Designer.store.layouts",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.layout"],model:"SpiceCRM.KReporter.Designer.model.layout",proxy:{type:"ajax",url:"KREST/KReporter/core/layouts",reader:{type:"json"}}}),Ext.define("SpiceCRM.KReporter.Designer.store.listFields",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.listFields"],model:"SpiceCRM.KReporter.Designer.model.listFields",renumberSequence:function(){for(var e=0;e<this.getCount();){var t=e+1;t<10&&(t="0"+t),this.getAt(e).set("sequence",t),e++}},getMaxSequence:function(){for(var e=0,t=0;t<this.getCount();)this.getAt(t).data.sequence>e&&(e=this.getAt(t).data.sequence),t++;return parseInt(e,10)},getNextSequence:function(){var e=this.getMaxSequence()+1;return e<10&&(e="0"+e),e},addFromReportRecord:function(e){var t=[];Ext.each(e,function(e){e.id&&delete e.id,t.push(e)},this),this.add(t)}}),Ext.define("SpiceCRM.KReporter.Designer.store.modules",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.modules"],model:"SpiceCRM.KReporter.Designer.model.modules",autoLoad:!0,proxy:{type:"ajax",url:"KREST/metadata/modules",extraParams:{session_id:window.sessionStorage.spiceUISession},reader:{type:"json"}}}),Ext.define("SpiceCRM.KReporter.Designer.store.moduletree",{extend:"Ext.data.TreeStore",requires:["SpiceCRM.KReporter.Designer.model.moduletree"],model:"SpiceCRM.KReporter.Designer.model.moduletree",proxy:{type:"ajax",url:"KREST/KReporter/core/nodes",extraParams:{nodeid:""},reader:{type:"json"}},autoLoad:!1,listeners:{beforeload:function(e,t,i){return""!==e.getProxy().extraParams.nodeid},nodebeforeexpand:function(e){this.getProxy().extraParams.nodeid=e.getPath().path}}}),Ext.define("SpiceCRM.KReporter.Designer.store.plugins",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.plugin"],model:"SpiceCRM.KReporter.Designer.model.plugin",load:function(){return!1}}),Ext.define("SpiceCRM.KReporter.Designer.store.securitygroups",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.securitygroups"],model:"SpiceCRM.KReporter.Designer.model.securitygroups",alias:"store.KReportDesignerSecurityGroups",proxy:{type:"ajax",url:"KREST/module/SecurityGroups",reader:{type:"json",rootProperty:"list",totalProperty:"totalcount"},extraParams:{fields:Ext.encode(["id","name"]),searchtermfields:Ext.encode(["name"])}}}),Ext.define("SpiceCRM.KReporter.Designer.store.teams",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.teams"],model:"SpiceCRM.KReporter.Designer.model.teams",alias:"store.KReportDesignerTeams",proxy:{type:"ajax",url:"KREST/module/Teams",reader:{type:"json",rootProperty:"list",totalProperty:"totalcount"},extraParams:{fields:Ext.encode(["id","name"]),searchtermfields:Ext.encode(["name"])}}}),Ext.define("SpiceCRM.KReporter.Designer.store.unionListFields",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.unionListField"],model:"SpiceCRM.KReporter.Designer.model.unionListField"}),Ext.define("SpiceCRM.KReporter.Designer.store.unionMappingPopupFields",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.unionMappingPopupField"],model:"SpiceCRM.KReporter.Designer.model.unionMappingPopupField"}),Ext.define("SpiceCRM.KReporter.Designer.store.unionModules",{extend:"Ext.data.TreeStore",requires:["SpiceCRM.KReporter.Designer.model.unionModule"],model:"SpiceCRM.KReporter.Designer.model.unionModule",proxy:{type:"ajax",url:"KREST/KReporter/core/nodes",extraParams:{nodeid:""},reader:{type:"json"}},autoLoad:!1,listeners:{beforeload:function(e,t,i){return""!==e.getProxy().extraParams.nodeid},nodebeforeexpand:function(e){this.getProxy().extraParams.nodeid=e.getPath().path}}}),Ext.define("SpiceCRM.KReporter.Designer.store.users",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.users"],model:"SpiceCRM.KReporter.Designer.model.users",pageSize:10,proxy:{type:"ajax",url:"KREST/KReporter/user/getlist",reader:{type:"json",rootProperty:"list",totalProperty:"totalcount"},extraParams:{fields:Ext.encode(["id","user_name","name","first_name","last_name"]),searchtermfields:Ext.encode(["user_name","first_name","last_name"])}},listeners:{beforeload:function(e,t,i){}}}),Ext.define("SpiceCRM.KReporter.Designer.store.vizColors",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.vizColor"],model:"SpiceCRM.KReporter.Designer.model.vizColor",autoLoad:!0,proxy:{type:"ajax",url:"KREST/KReporter/core/vizcolors",extraParams:{nodeid:""},reader:{type:"json"}}}),Ext.define("SpiceCRM.KReporter.Designer.store.whereclauses",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.whereclause"],model:"SpiceCRM.KReporter.Designer.model.whereclause",addFromReportRecord:function(e){var t=[];Ext.each(e,function(e){e.id&&delete e.id,"root"!=e.unionid&&"root"==e.groupid&&(e.groupid=e.unionid),t.push(e)},this),this.add(t)}}),Ext.define("SpiceCRM.KReporter.Designer.store.whereFunctions",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Common.model.parentField"],model:"SpiceCRM.KReporter.Common.model.parentField",proxy:{type:"ajax",url:"KREST/KReporter/core/wherefunctions",reader:{type:"json"}},autoLoad:!1}),Ext.define("SpiceCRM.KReporter.Designer.store.wheregroups",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Designer.model.wheregroup"],model:"SpiceCRM.KReporter.Designer.model.wheregroup",buildTree:function(e,t){this.clearFilter(),this.filter([{property:"unionid",value:t}]);var i=this.findRecord("id",e.get("id"));i&&e.set("type",i.get("type")),e.get("groupid")||e.set("groupid",e.get("id")),0<this.count()&&this.addNodeChildren(e)},addNodeChildren:function(i){this.each(function(e){if(e.get("parent")===i.id){var t=i.appendChild({id:e.get("id"),group:e.get("group"),groupid:e.get("groupid"),type:e.get("type"),selected:!0,draggable:!1});this.addNodeChildren(t)}},this)},addFromReportRecord:function(e){var t=[];Ext.each(e,function(e){e.groupid||(e.groupid=e.id),"root"!=e.unionid&&"root"==e.parent&&(e.parent=e.unionid),"root"!=e.unionid&&"root"==e.id&&(e.groupid=e.unionid,e.id=e.unionid),t.push(e)},this),this.add(t)}}),Ext.define("SpiceCRM.KReporter.Designer.store.wheretreeitems",{extend:"Ext.data.TreeStore",requires:["SpiceCRM.KReporter.Designer.model.wheretreeitem"],model:"SpiceCRM.KReporter.Designer.model.wheretreeitem",load:function(){return!1}}),Ext.define("SpiceCRM.KReporter.Designer.controller.Application",{extend:"Ext.app.Controller",doInit:function(){Ext.create("SpiceCRM.KReporter.Designer.store.vizColors",{storeId:"KReportDesginerHighChartsColorStore"})},finishInit:function(){},onLaunch:function(){},getReportId:function(){},createGuId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}),Ext.define("SpiceCRM.KReporter.Designer.controller.IntegrationContainerController",{extend:"Ext.app.ViewController",panels:{},currentPanelId:null,alias:"controller.KReportDesigner.IntegrationContainerController",config:{control:{"#integrationPluginsGridPanel":{cellclick:function(e,t,i,r,o,n){if(2==i)switch(r.get("active")){case 1:r.set("active",0),this.toggleActive(r.get("id"),0);break;default:r.set("active",1),this.toggleActive(r.get("id"),1)}},select:function(e,t){var i=Ext.ComponentQuery.query("#integrationPluginEditorPanel")[0];this.currentPanelId&&this.panels[this.currentPanelId]&&"function"==typeof this.panels[this.currentPanelId].getPanelData&&this.setIntegrationParams(this.currentPanelId,this.panels[this.currentPanelId].getPanelData()),i.removeAll(!1),this.currentPanelId=t.get("id"),t.get("panel")&&(!this.panels[this.currentPanelId]||this.panels[this.currentPanelId]&&this.panels[this.currentPanelId].destroyed?this.loadPanel(this.currentPanelId):i.add(this.panels[this.currentPanelId]))}}}},loadPanel:function(t){var i=Ext.data.StoreManager.lookup("KReportDesignerIntegrationPluginsStore").getById(t);Ext.Loader.loadScript({url:i.get("include"),onLoad:function(){i.set("loaded",!0);var e=Ext.ComponentQuery.query("#integrationPluginEditorPanel")[0];this.panels[t]=Ext.create(i.get("panel")),"function"==typeof this.panels[t].setPanelData&&this.panels[t].setPanelData(this.getIntegrationParams(t)),e.add(this.panels[t])},scope:this})},getIntegrationParams:function(e){var t=Ext.util.Format.htmlDecode(SpiceCRM.KReporter.Designer.Application.reportRecord.get("integration_params"));if(t&&""!==t){var i=Ext.decode(t);if(i[e])return i[e]}return{}},setIntegrationParams:function(e,t){var i={},r=Ext.util.Format.htmlDecode(SpiceCRM.KReporter.Designer.Application.reportRecord.get("integration_params"));r&&""!==r&&(i=Ext.decode(r)),i[e]=t,SpiceCRM.KReporter.Designer.Application.reportRecord.set("integration_params",Ext.util.Format.htmlEncode(Ext.encode(i)))},toggleActive:function(e,t){var i={},r=Ext.util.Format.htmlDecode(SpiceCRM.KReporter.Designer.Application.reportRecord.get("integration_params"));r&&""!==r&&(i=Ext.decode(r)),i.activePlugins||(i.activePlugins={}),i.activePlugins[e]=t,SpiceCRM.KReporter.Designer.Application.reportRecord.set("integration_params",Ext.util.Format.htmlEncode(Ext.encode(i)))},savePanel:function(){this.currentPanelId&&this.panels[this.currentPanelId]&&"function"==typeof this.panels[this.currentPanelId].getPanelData&&this.setIntegrationParams(this.currentPanelId,this.panels[this.currentPanelId].getPanelData())}}),Ext.define("SpiceCRM.KReporter.Designer.controller.listFieldsController",{extend:"Ext.app.ViewController",requires:[],alias:"controller.KReportDesignerListFieldsController",config:{listen:{global:{mainExpanded:function(){this.view.show()},unionExpanded:function(){this.view.hide()}}},control:{"#kreportsdesignerlistgriddeletefieldbutton":{click:function(){var e=this.view.getSelection(),t=[];Ext.each(e,function(e){t.push(e.get("fieldid"))}),this.view.store.remove(e),Ext.globalEvents.fireEvent("listFieldsDeleted",t)}},"#kreportsdesignerlistgridaddfixedbutton":{click:function(){var e={fieldid:SpiceCRM.KReporter.Designer.Application.kGuid(),name:"enter name",path:"",displaypath:"",display:"yes",sequence:this.view.store.getNextSequence(),width:100,sort:"-",sortpriority:"",jointype:"required",sqlfunction:"-",groupby:"no",link:"no",fixedvalue:""};this.view.store.add(e),Ext.globalEvents.fireEvent("listFieldAdded",e)}},"#":{select:function(e,t){var i=t.get("path").split(":"),r=Ext.data.StoreManager.lookup("KReportDesignerBucketsStore");r.clearFilter(),r.filter("fieldname",i[i.length-1])}}}},onBeforeDrop:function(e,t,o,n,i,r){var a=this.view.store;if("SpiceCRM.KReporter.Designer.model.fields"===t.records[0].$className){Ext.ComponentQuery.query("ModuleTree")[0].getSelectionModel().getLastSelected();return Ext.each(t.records,function(e){var t=Ext.ComponentQuery.query("#ModuleTreeGrid")[0].controller.getRootPath(),i=a.indexOf(o);"after"==n&&i++;var r={fieldid:SpiceCRM.KReporter.Designer.Application.kGuid(),path:t.path+"::field:"+e.get("name"),displaypath:t.displayPath,fieldname:e.get("name"),name:e.get("text"),display:"yes",sequence:a.getNextSequence(),width:100,sort:"-",sortpriority:"",jointype:"required",sqlfunction:"-",summaryfunction:"",groupby:"no",link:"no",fixedvalue:"",id:SpiceCRM.KReporter.Designer.Application.kGuid()};Ext.globalEvents.fireEvent("listFieldAdded",r),i==a.count()?a.add(r):a.insert(i,r)},this),i.cancelDrop(),!0}var d,l,s=0;switch(n){case"after":s=Number(o.get("sequence"))+1;break;case"before":s=Number(o.get("sequence"))}for(d=Number(t.records[0].get("sequence"));d<s-1;d++)a.getAt(d).get("sequence")!==t.records[0].data.sequence&&((l=Number(a.getAt(d).get("sequence"))-1)<10&&(l="0"+l),a.getAt(d).set("sequence",l));for(d=s-1;d<a.getCount();d++)a.getAt(d).get("sequence")!==t.records[0].data.sequence&&((l=Number(a.getAt(d).get("sequence"))+1)<10&&(l="0"+l),a.getAt(d).set("sequence",l));return s<10&&(s="0"+s),t.records[0].set("sequence",s),a.sort("sequence","ASC"),a.renumberSequence(),i.cancelDrop(),!0},base64Renderer:function(t){if(!t||""===t||null===t)return t;try{_tbfvalue=decodeURIComponent(atob(t))}catch(e){_tbfvalue=atob(t)}return Ext.util.Format.htmlEncode(_tbfvalue)}}),Ext.define("SpiceCRM.KReporter.Designer.controller.MainController",{extend:"Ext.app.ViewController",requires:[],saving:!1,alias:"controller.KReportDesignerMain",loadMask:void 0,config:{listen:{global:{designersysinfo:function(r,e){var t=sessionStorage.getItem("kval"+r.systemkey);if(null===t){var i,o=[];for(i in e.integration)o.push(i);for(i in e.presentation)o.push(i);for(i in e.visualization)o.push(i);3<10*SpiceCRM.KReporter.Designer.Application.getRand()&&Ext.Ajax.request({url:window.atob("S1JFU1QvbW9kdWxlL1VzZXJz"),method:"GET",params:{searchfields:window.atob("eyJmaWVsZCI6InN0YXR1cyIsIm9wZXJhdG9yIjoiPSIsInZhbHVlIjoiQWN0aXZlIn0=")},success:function(e){var t=Ext.JSON.decode(e.responseText);Ext.Ajax.request({url:window.atob("aHR0cHM6Ly9zdXBwb3J0LnNwaWNlY3JtLmlv"),method:"GET",params:{x:this.atoc(window.btoa(Ext.encode({sysinfo:r,plugins:o,users:t.totalcount})))},success:function(e,t){var i=Ext.JSON.decode(decodeURIComponent(e.responseText));i[window.atob("bGljZW5zZXN0YXR1cw==")]?sessionStorage.setItem("kval"+r.systemkey,!0):(Ext.globalEvents.fireEvent("lf",i[window.atob("bGljZW5zZW1lc3NhZ2U=")]),sessionStorage.setItem("kval"+r.systemkey,window.btoa(i[window.atob("bGljZW5zZW1lc3NhZ2U=")])))}})},scope:this})}else"true"!==t&&Ext.globalEvents.fireEvent("dlf",window.atob(t))}}}},atoc:function(e){return e.replace(/[a-zA-Z]/g,function(e){return String.fromCharCode((e<="Z"?90:122)>=(e=e.charCodeAt(0)+13)?e:e-26)})}}),Ext.define("SpiceCRM.KReporter.Designer.controller.MainToolbarController",{extend:"Ext.app.ViewController",requires:[],saving:!1,alias:"controller.KReportDesignerMainToolbar",loadMask:void 0,config:{listen:{global:{sysinfo:function(e,t){var i=this.view.down("#assigneduserid");i&&!i.getValue()&&(SpiceCRM.KReporter.Designer.Application.reportRecord.get("assigned_user_id")||(SpiceCRM.KReporter.Designer.Application.reportRecord.set("assigned_user_id",e.current_user_id),SpiceCRM.KReporter.Designer.Application.reportRecord.set("assigned_user_name",e.current_user_name)),i.getStore().add({id:SpiceCRM.KReporter.Designer.Application.reportRecord.get("assigned_user_id"),name:SpiceCRM.KReporter.Designer.Application.reportRecord.get("assigned_user_name")}),i.setValue(SpiceCRM.KReporter.Designer.Application.reportRecord.get("assigned_user_id")))},dlf:function(e){this.view.down("#repVersion").update(atob(SpiceCRM.KReporter.versionstring)+" ("+e+")"),Ext.each(this.view.query("button"),function(e){e.disable()}),Ext.each(SpiceCRM.KReporter.Designer.Application.thisMainView.query("panel"),function(e){e.disable()})}}},control:{"#save":{click:"saveReport"},"#cancel":{click:"cancelReport"},"#reportname":{change:function(e,t){SpiceCRM.KReporter.Designer.Application.reportRecord.set("name",t)}},"#assignedcategoryid":{select:function(e,t){SpiceCRM.KReporter.Designer.Application.reportRecord.set("category_id",t.get("id"))},beforerender:function(e){e.getStore().add({id:SpiceCRM.KReporter.Designer.Application.reportRecord.get("category_id"),name:SpiceCRM.KReporter.Designer.Application.reportRecord.get("category_name")}),e.setValue(SpiceCRM.KReporter.Designer.Application.reportRecord.get("category_id"))},afterrender:function(e){SpiceCRM.KReporter.Common.isKReporterPro()&&e.show()}},"#assignedcategorypriority":{beforerender:function(e){e.setValue(SpiceCRM.KReporter.Designer.Application.reportRecord.get("category_priority"))},afterrender:function(e){SpiceCRM.KReporter.Common.isKReporterPro()&&e.show()}},"#assigneduserid":{select:function(e,t){SpiceCRM.KReporter.Designer.Application.reportRecord.set("assigned_user_id",t.get("id"))},beforerender:function(e){e.getStore().add({id:SpiceCRM.KReporter.Designer.Application.reportRecord.get("assigned_user_id"),name:SpiceCRM.KReporter.Designer.Application.reportRecord.get("assigned_user_name")}),e.setValue(SpiceCRM.KReporter.Designer.Application.reportRecord.get("assigned_user_id"))}},"#assignedteamid":{select:function(e,t){SpiceCRM.KReporter.Designer.Application.reportRecord.set("team_id",t.get("id"))},beforerender:function(e){e.getStore().add({id:SpiceCRM.KReporter.Designer.Application.reportRecord.get("team_id"),name:SpiceCRM.KReporter.Designer.Application.reportRecord.get("team_name")}),e.setValue(SpiceCRM.KReporter.Designer.Application.reportRecord.get("team_id"))}},"#assignedkorgid":{select:function(e,t){SpiceCRM.KReporter.Designer.Application.reportRecord.set("korgobjectmain",t.get("korgobjectmain"))},beforerender:function(e){e.getStore().add({id:SpiceCRM.KReporter.Designer.Application.reportRecord.get("korgobjectmain"),name:SpiceCRM.KReporter.Designer.Application.reportRecord.get("korgobjectmain_name")}),e.setValue(SpiceCRM.KReporter.Designer.Application.reportRecord.get("korgobjectmain"))},afterrender:function(e){SpiceCRM.KReporter.config&&SpiceCRM.KReporter.config.korgmanaged&&e.show()}},"#assignedsecuritygroupid":{select:function(e,t){SpiceCRM.KReporter.Designer.Application.reportRecord.set("assignedsecuritygroupid",t.get("assignedsecuritygroupid"))},beforerender:function(e){e.getStore().add({id:SpiceCRM.KReporter.Designer.Application.reportRecord.get("securitygroup_id"),name:SpiceCRM.KReporter.Designer.Application.reportRecord.get("securitygroup_name")}),e.setValue(SpiceCRM.KReporter.Designer.Application.reportRecord.get("securitygroup_id"))},afterrender:function(e){SpiceCRM.KReporter.config&&SpiceCRM.KReporter.config.securitygroups&&e.show()}}}},cancelReport:function(){window.onbeforeunload=null,SpiceCRM.KReporter.Designer.Application.reportRecord.get("newWithId")?SpiceCRM.KReporter.Common.redirect("list",{}):SpiceCRM.KReporter.Common.redirect("detail",{id:SpiceCRM.KReporter.Designer.Application.reportRecord.get("id")})},saveReport:function(){if(!0!==this.saving)if(window.onbeforeunload=null,""!==SpiceCRM.KReporter.Designer.Application.reportRecord.get("name")){this.loadMask||(this.loadMask=new Ext.LoadMask({msg:languageGetText("LBL_SAVEMASK"),target:this.view.up()})),this.loadMask.show(),this.saving=!0;var t=[];Ext.data.StoreManager.lookup("KReportDesignerListFieldsStore").each(function(e){t.push(e.data)}),SpiceCRM.KReporter.Designer.Application.reportRecord.set("listfields",Ext.encode(t));var i=[];Ext.data.StoreManager.lookup("kreportdesginerUnionModules").getRoot().eachChild(function(e){i.push({unionid:e.get("unionid"),module:e.get("module")})}),0<i.length?SpiceCRM.KReporter.Designer.Application.reportRecord.set("union_modules",Ext.encode(i)):SpiceCRM.KReporter.Designer.Application.reportRecord.set("union_modules","");var r=[];Ext.data.StoreManager.lookup("KReportDesignerUnionListFieldsStore").clearFilter(!0),Ext.data.StoreManager.lookup("KReportDesignerUnionListFieldsStore").each(function(e){r.push(e.data)}),SpiceCRM.KReporter.Designer.Application.reportRecord.set("unionlistfields",Ext.encode(r));var o=[];Ext.data.StoreManager.lookup("KReportDesignerWhereGroupsStore").clearFilter(!0),Ext.data.StoreManager.lookup("KReportDesignerWhereGroupsStore").each(function(e){o.push(e.data)}),SpiceCRM.KReporter.Designer.Application.reportRecord.set("wheregroups",Ext.encode(o));var n=[];Ext.data.StoreManager.lookup("KReportDesignerWhereClausesStore").clearFilter(!0),Ext.data.StoreManager.lookup("KReportDesignerWhereClausesStore").each(function(e){n.push(e.data)}),SpiceCRM.KReporter.Designer.Application.reportRecord.set("whereconditions",Ext.encode(n)),this.view.up().down("#KReportDetailsPresentationContainer").getController().savePanel(),this.view.up().down("#KReportDetailsVisualizationContainer").getController().savePanel(),this.view.up().down("#KReportDetailsIntegrationContainer").getController().savePanel(),slimit=Ext.ComponentQuery.query("#listgridSelectionLimit")[0].getValue(),stype=Ext.ComponentQuery.query("#listgridSelectionLimType")[0].getValue(),selectionlimit="",null!==slimit&&null!==stype&&(selectionlimit=slimit+" "+stype),SpiceCRM.KReporter.Designer.Application.reportRecord.set("selectionlimit",selectionlimit),SpiceCRM.KReporter.config&&SpiceCRM.KReporter.config.korgmanaged&&(SpiceCRM.KReporter.Designer.Application.reportRecord.set("korgobjectmain",Ext.ComponentQuery.query("#assignedkorgid")[0].getValue()),SpiceCRM.KReporter.Designer.Application.reportRecord.set("korgobjectmultiple",Ext.util.Format.htmlEncode(Ext.encode({primary:null})))),SpiceCRM.KReporter.config&&SpiceCRM.KReporter.config.securitygroups&&SpiceCRM.KReporter.Designer.Application.reportRecord.set("securitygroup_id",Ext.ComponentQuery.query("#assignedsecuritygroupid")[0].getValue()),SpiceCRM.KReporter.Designer.Application.reportRecord.set("category_id",Ext.ComponentQuery.query("#assignedcategoryid")[0].getValue()),SpiceCRM.KReporter.Designer.Application.reportRecord.set("category_priority",Ext.ComponentQuery.query("#assignedcategorypriority")[0].getValue()),SpiceCRM.KReporter.Designer.Application.reportRecord.set("listtype",Ext.ComponentQuery.query("#presentationPluginCombo")[0].getValue()),Ext.Ajax.request({url:"KREST/module/KReports/"+SpiceCRM.KReporter.Designer.Application.reportRecord.get("id"),jsonData:SpiceCRM.KReporter.Designer.Application.reportRecord.data,method:"POST",success:function(e,t){SpiceCRM.KReporter.config.securitygroups&&Ext.Ajax.request({url:"KREST/KReporter/securitygroups/save",jsonData:SpiceCRM.KReporter.Designer.Application.reportRecord.data,method:"POST",success:function(e,t){},scope:this}),this.loadMask.hide();var i=SpiceCRM.KReporter.Designer.Application.reportRecord.get("id");SpiceCRM.KReporter.Common.redirect("detail",{id:i,target:"self"})},scope:this})}else Ext.Msg.alert(languageGetText("LBL_ERROR"),languageGetText("LBL_ERROR_NAME"))}}),Ext.define("SpiceCRM.KReporter.Designer.controller.SubPanelFieldlistController",{extend:"Ext.app.ViewController",requires:[],alias:"controller.KReportDesigner.FieldllistController",config:{listen:{global:{moduleSelected:"loadFields"}},control:{"#fieldFilter":{change:function(e,t){this.view.store.clearFilter(),""!==t&&this.view.store.filter("text",new RegExp(t,"i"))}}}},loadFields:function(e){if(e.getPath().path){var t=this.getView().getStore();t.removeAll(),t.getProxy().extraParams.nodeid=e.getPath().path,t.load()}}}),Ext.define("SpiceCRM.KReporter.Designer.controller.moduleListController",{extend:"Ext.app.ViewController",requires:[],alias:"controller.moduleList",handleSelect:function(e,t){Ext.globalEvents.fireEvent("subpanelSelected",t)},config:{control:{panel:{select:"handleSelect"}}}}),Ext.define("SpiceCRM.KReporter.Designer.controller.ModuleTreeController",{extend:"Ext.app.ViewController",requires:[],alias:"controller.ModuleTreeController",config:{listen:{global:{mainModuleAdded:function(e){this.setMainModuleNode({path:"root:"+e,module:e,name:"rootnode",expanded:!1,id:"root"})}}},control:{"#":{expand:function(){Ext.globalEvents.fireEvent("mainExpanded")},select:function(e,t){Ext.globalEvents.fireEvent("moduleSelected",t)}},"#mainModuleSelector":{initialize:function(e,t){e.setValue(t),e.disable(),Ext.globalEvents.fireEvent("mainModuleAdded",t)},select:function(e,t,i){SpiceCRM.KReporter.Designer.Application.reportRecord.set("report_module",t.data.module),e.disable(),Ext.globalEvents.fireEvent("mainModuleAdded",t.data.module)}}}},setMainModuleNode:function(e){var t=this.view.getRootNode().appendChild(e);this.view.getRootNode().expand(),this.view.setSelection(t),Ext.globalEvents.fireEvent("moduleSelected",Ext.create("SpiceCRM.KReporter.Designer.model.moduletree",e))},getRootPath:function(){return this.view.getSelectionModel().getLastSelected().getPath()}}),Ext.define("SpiceCRM.KReporter.Designer.controller.PresentationContainerController",{extend:"Ext.app.ViewController",panels:{},currentPanelId:null,alias:"controller.KReportDesigner.PresentationContainerController",config:{listen:{global:{designerPluginsLoaded:function(){this.initialize()}}},control:{"#presentationPluginCombo":{select:function(e,t){this.setPanel(t.get("id"))}}}},initialize:function(){var e=this.getParams();e.plugin?(this.view.down("combo[itemId=presentationPluginCombo]").setValue(e.plugin),this.setPanel(e.plugin)):(this.view.down("combo[itemId=presentationPluginCombo]").setValue("standard"),this.setPanel("standard"))},setPanel:function(e){this.view.removeAll(!1),this.currentPanelId=e,!this.panels[this.currentPanelId]||this.panels[this.currentPanelId]&&this.panels[this.currentPanelId].destroyed?this.loadPanel(this.currentPanelId):this.view.add(this.panels[this.currentPanelId])},loadPanel:function(e){var t=Ext.data.StoreManager.lookup("KReportDesignerPresentationPluginsStore").getById(e);Ext.Loader.loadScript({url:t.get("include"),onLoad:function(){t.set("loaded",!0),this.panels[e]=Ext.create(t.get("panel")),"function"==typeof this.panels[e].initialize&&this.panels[e].initialize(this.getPresentationParams(e)),this.view.add(this.panels[e])},scope:this})},getPresentationParams:function(e){var t=this.getParams();return t.plugin===e?t.pluginData:{}},setPresentationParams:function(e,t){var i={plugin:e,pluginData:t};this.setParams(i)},getParams:function(){var e={},t=Ext.util.Format.htmlDecode(SpiceCRM.KReporter.Designer.Application.reportRecord.get("presentation_params"));return t&&""!==t&&(e=Ext.decode(t)),e},setParams:function(e){SpiceCRM.KReporter.Designer.Application.reportRecord.set("presentation_params",Ext.util.Format.htmlEncode(Ext.encode(e)))},savePanel:function(){this.currentPanelId&&this.setPresentationParams(this.currentPanelId,this.panels[this.currentPanelId].getPanelData())}}),Ext.define("SpiceCRM.KReporter.Designer.controller.unionListFieldsController",{extend:"Ext.app.ViewController",mappingWindow:null,alias:"controller.KReportDesignerUnionListFieldsController",unionid:null,config:{listen:{global:{mainExpanded:function(){this.view.hide()},unionExpanded:function(){this.view.show()},unionChanged:function(e){this.view.store.filter("joinid",e),this.unionid=e},listFieldAdded:function(t){Ext.each(Ext.ComponentQuery.query("#UnionTree")[0].getRootNode().childNodes,function(e){this.view.store.add({joinid:e.get("unionid"),fieldid:t.fieldid,sequence:null,name:t.name,unionfieldpath:null,unionfielddisplaypath:null,unionfieldname:null,path:t.path,displaypath:t.displaypath,fixedvalue:null,id:SpiceCRM.KReporter.Designer.Application.kGuid()})},this)},listFieldsDeleted:function(t){this.view.store.removeFilter(),this.view.store.each(function(e){-1<t.indexOf(e.get("fieldid"))&&this.view.store.remove(e)},this),this.view.store.filter("joinid",this.unionid)}}}},onBeforeDrop:function(e,t,i,r,o,n){return this.mappingWindow||(this.mappingWindow=Ext.create("SpiceCRM.KReporter.Designer.window.KReportDetails.unionMappingPopup")),this.mappingWindow.unionid=this.unionid,this.mappingWindow.unionfields=this.view.store,this.mappingWindow.mappingrecord=t.records[0],this.mappingWindow.show(this),o.cancelDrop(),!0}}),Ext.define("SpiceCRM.KReporter.Designer.controller.UnionTreeController",{extend:"Ext.app.ViewController",alias:"controller.UnionTreeController",currentUnionId:null,config:{listen:{global:{mainModuleAdded:function(e){this.view.enable()},initialize:function(){SpiceCRM.KReporter.Designer.Application.reportRecord.get("union_modules")&&(_unionModules=Ext.decode(Ext.util.Format.htmlDecode(SpiceCRM.KReporter.Designer.Application.reportRecord.get("union_modules"))),Ext.each(_unionModules,function(e){this.view.getRootNode().appendChild({id:e.unionid,unionid:e.unionid,module:e.module,path:"union"+e.unionid+":"+e.module,selected:!0,draggable:!1}),this.view.getRootNode().expand()}))}}},control:{"#":{expand:function(){_selected=this.view.getSelection()[0],!_selected&&0<this.view.getRootNode().childNodes.length&&(_selected=this.view.getRootNode().childNodes[0],this.view.setSelection(_selected)),Ext.globalEvents.fireEvent("unionExpanded",_selected?this.getUnionIdForNode(_selected):null)},select:function(e,t){_recordUnionId=this.getUnionIdForNode(t),this.currentUnionId!==_recordUnionId&&(this.currentUnionId=_recordUnionId,Ext.globalEvents.fireEvent("unionChanged",this.currentUnionId)),this.view.down("#unionModuleDelButton").enable(),Ext.globalEvents.fireEvent("moduleSelected",t)}},"#unionModuleSelector":{change:function(e,t){e.getValue()&&Ext.ComponentQuery.query("#unionModuleAddButton")[0].enable()}},"#unionModuleAddButton":{click:function(){_unionid=SpiceCRM.KReporter.Designer.Application.kGuid(),_newNode=this.view.getRootNode().appendChild({id:_unionid,unionid:_unionid,module:Ext.ComponentQuery.query("#unionModuleSelector")[0].getValue(),path:"unionroot::union"+_unionid+":"+Ext.ComponentQuery.query("#unionModuleSelector")[0].getValue(),selected:!0,draggable:!1}),Ext.data.StoreManager.lookup("KReportDesignerWhereGroupsStore").add({id:_unionid,groupid:_unionid,unionid:_unionid,group:"root",type:"AND",parent:"-"}),this.view.expandNode(this.view.getRootNode()),Ext.data.StoreManager.lookup("KReportDesignerListFieldsStore").each(function(e){Ext.data.StoreManager.lookup("KReportDesignerUnionListFieldsStore").add({id:SpiceCRM.KReporter.Designer.Application.kGuid(),joinid:_unionid,fieldid:e.get("fieldid"),name:e.get("name"),path:e.get("path"),displaypath:e.get("displaypath")})},this),Ext.ComponentQuery.query("#unionModuleSelector")[0].setValue(null),this.view.setSelection(_newNode)}},"#unionModuleDelButton":{click:function(){_selectedNode=this.view.getSelection()[0],this.view.getRootNode().removeChild(_selectedNode),Ext.data.StoreManager.lookup("kreportdesginerUnionModules").remove(_selectedNode),this.view.getSelectionModel().select(0),this.view.getSelection().length<=0&&(this.view.down("#unionModuleDelButton").disable(),Ext.data.StoreManager.lookup("KReportDesignerUnionListFieldsStore").removeAll(),Ext.data.StoreManager.lookup("KReportDesignerWhereClausesStore").each(function(e){e.get("unionid")==_selectedNode.get("unionid")&&Ext.data.StoreManager.lookup("KReportDesignerWhereClausesStore").remove(e)}),Ext.data.StoreManager.lookup("KReportDesignerWhereGroupsStore").each(function(e){e.get("groupid")==_selectedNode.get("unionid")&&Ext.data.StoreManager.lookup("KReportDesignerWhereGroupsStore").remove(e)}))}}}},doInit:function(){},onLaunch:function(){},finishInit:function(){},getUnionIdForNode:function(e){return"uniontreeroot"===e.parentNode.get("id")||"root"===e.parentNode.get("id")?e.get("unionid"):this.getUnionIdForNode(e.parentNode)},getUnionPath:function(){return this.view.getSelectionModel().getLastSelected().getPath()}}),Ext.define("SpiceCRM.KReporter.Designer.controller.VisualizationContainerController",{extend:"Ext.app.ViewController",panels:{},currentPanelId:null,alias:"controller.KReportDesigner.VisualizationContainerController",initializePanel:function(){var e=this.getParams();e.layout&&this.view.down("combo[itemId=layoutCombo]").setValue(e.layout).fireEvent("select",this.view.down("combo[itemId=layoutCombo]")),e.chartheight&&this.view.down("#vizHeightSpinner").setValue(e.chartheight)},config:{listen:{global:{designerPluginsLoaded:function(){this.initializePanel()}}},control:{"#layoutCombo":{select:function(e){"-"!=e.getValue()?(this.view.down("#vizHeightSpinner").enable(!0),this.view.down("#visualizationPluginCombo").enable(!0),this.view.down("#chartSpinner").enable(!0),this.view.down("#chartSpinner").setMaxValue(e.getStore().findRecord("name",e.getValue()).get("count"))):(this.view.down("#vizHeightSpinner").disable(!0),this.view.down("#visualizationPluginCombo").disable(!0),this.view.down("#chartSpinner").disable(!0),this.view.down("#chartSpinner").setMaxValue(0),this.view.removeAll(!1));var t=this.getParams();t.layout=e.getValue(),this.setParams(t)}},"#visualizationPluginCombo":{select:function(e,t){var i=this.view;i.removeAll(!1),this.currentPanelId=t.get("id"),!this.panels[this.currentPanelId]||this.panels[this.currentPanelId]&&this.panels[this.currentPanelId].destroyed?this.loadPanel(this.currentPanelId,{}):(i.add(this.panels[this.currentPanelId]),this.panels[this.currentPanelId].setPanelData({}))}},"#vizHeightSpinner":{spinup:function(e){var t=this.getParams();t.chartheight=parseInt(e.getValue()),this.setParams(t)},spindown:function(e){var t=this.getParams();t.chartheight=parseInt(e.getValue()),this.setParams(t)}},"#chartSpinner":{spinup:function(e){var t=parseInt(e.getValue());this.currentPanelId&&this.setVisualizationParams(t,this.currentPanelId,this.panels[this.currentPanelId].getPanelData()),t===e.max?t=1:t+=1,e.setValue(t),this.switchPanelToIndex(t)},spindown:function(e){var t=parseInt(e.getValue());this.currentPanelId&&this.setVisualizationParams(t,this.currentPanelId,this.panels[this.currentPanelId].getPanelData()),1===t||0===t?t=e.max:t-=1,e.setValue(t),this.switchPanelToIndex(t)}}}},loadPanel:function(e,t){var i=Ext.data.StoreManager.lookup("KReportDesignerVisualizationPluginsStore").getById(e);!1===i.get("loaded")&&Ext.Loader.loadScript({url:i.get("include"),onLoad:function(){i.set("loaded",!0),this.panels[e]=Ext.create(i.get("panel")),this.panels[e].setPanelData(t),this.view.add(this.panels[e])},scope:this})},switchPanelToIndex:function(e){var t=this.getVisualizationParams(e);if(this.currentPanelId="",this.view.removeAll(!1),this.view.down("combobox[itemId=visualizationPluginCombo]").clearValue(),t.pluginid){if(this.currentPanelId=t.pluginid,this.panels[this.currentPanelId])this.panels[this.currentPanelId].setPanelData(t.plugindata),this.view.add(this.panels[this.currentPanelId]);else{this.view.down("combo[itemId=visualizationPluginCombo]").getStore().getById(t.pluginid);this.loadPanel(t.pluginid,t.plugindata)}this.view.down("combobox[itemId=visualizationPluginCombo]").setValue(this.currentPanelId)}},getVisualizationParams:function(e){var t=this.getParams();return 0<e&&t[e]&&t[e].plugin&&t[e][t[e].plugin]?{pluginid:t[e].plugin,plugindata:t[e][t[e].plugin]}:0<e&&t[e]&&t[e].plugin?{plugoinid:t[e].plugin,plugindata:{}}:{plugoinid:"",plugindata:{}}},setVisualizationParams:function(e,t,i){var r=this.getParams();r[e]?r[e].plugin=t:r[e]={plugin:t},r[e][t]=i,this.setParams(r)},getParams:function(){var e={},t=Ext.util.Format.htmlDecode(SpiceCRM.KReporter.Designer.Application.reportRecord.get("visualization_params"));return t&&""!==t&&(e=Ext.decode(t)),e},setParams:function(e){SpiceCRM.KReporter.Designer.Application.reportRecord.set("visualization_params",Ext.util.Format.htmlEncode(Ext.encode(e)))},savePanel:function(){this.currentPanelId&&this.setVisualizationParams(this.view.down("spinnerfield[itemId=chartSpinner]").getValue(),this.currentPanelId,this.panels[this.currentPanelId].getPanelData())}}),Ext.define("SpiceCRM.KReporter.Designer.controller.WhereClauseController",{extend:"Ext.app.ViewController",alias:"controller.KReportDesignerWhereClauseController",groupid:null,unionid:"root",whereClauseLastClick:{},whereConfig:{},init:function(){this.whereOperatorStore=Ext.create("SpiceCRM.KReporter.Common.store.whereOperators","kreporterWhereOperatorStore"),this.enumOptionsStore=Ext.create("SpiceCRM.KReporter.Common.store.enumoptions","kreporterEnumoptionsStore"),this.parentFieldsStore=Ext.create("SpiceCRM.KReporter.Common.store.parentFields","kreporterParentFieldsStore"),this.whereFunctionsStore=Ext.create("SpiceCRM.KReporter.Designer.store.whereFunctions","kreporterWhereFunctionsStore").load(),this.autocompleteStore=Ext.create("SpiceCRM.KReporter.Common.store.autcompleterecords","kreporterAutocmpleteStore").load(),Ext.Ajax.request({url:"KREST/KReporter/core/whereinitialize",method:"GET",success:function(e,t){this.whereConfig=Ext.decode(e.responseText)},scope:this})},config:{listen:{global:{whereGroupSelected:function(e){this.groupid=e.get("groupid"),this.view.store.filter("groupid",e.get("groupid")),this.view.setSelection(null)},whereClauseSelected:function(e){this.id=e.get("id"),this.view.store.filter("id",e.get("id")),this.view.setSelection(null)},mainExpanded:function(){this.unionid="root"},unionExpanded:function(e){this.unionid=e||null},unionChanged:function(e){this.unionid=e}}},control:{"#":{beforeedit:function(e,t,i){SpiceCRM.KReporter.Common.gridSetEditor(t,this,SpiceCRM.KReporter.Designer.Application)},edit:function(e,t){this.gridAfterEdit(t)},click:function(t){this.whereClauseLastClick=e.getXY()},select:function(e,t){this.view.down("#WhereClauseDeleteButton").enable();var i=t.get("path").split(":"),r=Ext.data.StoreManager.lookup("KReportDesignerBucketsWhereStore");r.clearFilter(),r.filter("fieldname",i[i.length-1])}},"#WhereClauseDeleteButton":{click:function(){var e=this.view.getSelection()[0];Ext.data.StoreManager.lookup("KReportDesignerWhereClausesStore").remove(e),this.view.getSelection().length<=0&&this.view.down("#WhereClauseDeleteButton").disable()}}}},onBeforeDrop:function(e,t,i,r,o,n){Ext.ComponentQuery.query("ModuleTree")[0].getSelectionModel().getLastSelected();return Ext.each(t.records,function(e){var t={},i=(t="root"===this.unionid?Ext.ComponentQuery.query("#ModuleTreeGrid")[0].controller.getRootPath():Ext.ComponentQuery.query("#UnionTree")[0].controller.getUnionPath()).path+"::field:"+e.get("name"),r=t.displayPath;this.view.store.add({id:SpiceCRM.KReporter.Designer.Application.kGuid(),unionid:this.unionid,fieldid:SpiceCRM.KReporter.Designer.Application.kGuid(),path:i,name:e.get("text"),type:e.get("type"),displaypath:r,groupid:this.groupid,referencefieldid:"",operator:"ignore",jointype:"required",usereditable:"no",dashleteditable:"no",exportpdf:"no"})},this),o.cancelDrop(),!0},gridAfterEdit:function(e){switch(e.column.itemId){case"value":case"valueto":switch(e.record.data.operator){case"autocomplete":case"parent_assign":case"function":e.record.set(e.column.itemId+"key",e.value);break;case"reference":break;default:switch(e.record.data.type){case"datetime":case"datetimecombo":break;case"date":switch(e.record.data.operator){case"lastndays":case"lastnfdays":case"lastnweeks":case"notlastnweeks":case"lastnfweeks":case"lastnfmonth":case"lastnmonthDaily":case"lastnfquarter":case"lastnyear":case"lastnyearDaily":case"nextndays":case"nextnweeks":case"notnextnweeks":case"nextnmonth":case"nextnmonthDaily":case"nextnfquarter":case"nextnyear":case"nextnyearDaily":case"betwndays":break;case"lastnddays":case"nextnddays":case"betwnddays":break;default:e.record.set(e.column.itemId+"key",Ext.Date.format(e.value,"Y-m-d")),e.record.set(e.column.itemId,Ext.Date.format(e.value,cal_date_format.replace(/%/g,"")))}break;case"user_name":case"assigned_user_name":case"enum":case"radioenum":case"parent_type":case"multienum":switch(e.record.data.operator){case"oneof":case"oneofnot":case"oneofnotornull":break;case"starts":case"notstarts":case"contains":case"notcontains":break;default:e.record.set(e.column.itemId+"key",e.value);var t=e.column.getEditor().getStore(),i=t.find("value",e.value);0<i&&e.record.set(e.column.itemId,t.getAt(i).get("text"))}break;case"bool":e.record.set(e.column.itemId+"key",e.value),e.record.set(e.column.itemId,languageGetText("LBL_BOOL_"+e.value))}}break;case"operator":e.record.set("value",""),e.record.set("valueto",""),e.record.set("valuekey",""),e.record.set("valuetokey","")}},getOperatorCount:function(e,t){return this.whereConfig.operatorCount[e],this.whereConfig.operatorCount[e]}}),Ext.define("SpiceCRM.KReporter.Designer.controller.WhereTreeController",{extend:"Ext.app.ViewController",requires:[],unionid:"root",alias:"controller.KReportDesignerWhereTreeController",config:{listen:{global:{mainExpanded:function(){this.unionid="root",this.view.setRoot("root"),Ext.globalEvents.fireEvent("whereGroupSelected",this.view.getRootNode())},unionExpanded:function(e){e&&(this.unionid=e,this.view.setRoot(e),Ext.globalEvents.fireEvent("whereGroupSelected",this.view.getRootNode()))},unionChanged:function(e){this.unionid=e,this.view.setRoot(e),Ext.globalEvents.fireEvent("whereGroupSelected",this.view.getRootNode())}}},control:{"#":{beforeitemexpand:function(e){},select:function(e,t){Ext.globalEvents.fireEvent("whereGroupSelected",t),0===t.childNodes.length&&t.get("id")!==this.view.getRootNode().get("id")?this.view.down("#WhereGroupDeleteButton").enable():this.view.down("#WhereGroupDeleteButton").disable()}},"#WhereGroupAddButton":{click:function(){this.addNode()}},"#WhereGroupDeleteButton":{click:function(){var e=this.view.getSelection()[0];whereGroupsStore=Ext.data.StoreManager.lookup("KReportDesignerWhereGroupsStore"),whereGroupsStore.remove(whereGroupsStore.getById(e.get("id"))),Ext.data.StoreManager.lookup("KReportDesignerWhereClausesStore").removeAll(),this.view.setSelection(e.parentNode),e.remove()}},"#WhereGroupOperator":{change:function(e,t){var i=this.view.getSelection();whereGroupsStore=Ext.data.StoreManager.lookup("KReportDesignerWhereGroupsStore"),whereGroupsStore.findRecord("id",i[0].id).set("type",t)}}}},addNode:function(){Ext.Msg.prompt(languageGetText("LBL_ADD_GROUP_NAME"),languageGetText("LBL_CHANGE_GROUP_NAME_PROMPT"),function(e,t){if("ok"==e){var i=this.view.getSelection()[0];_childId=SpiceCRM.KReporter.Designer.Application.kGuid();var r=i.appendChild({id:_childId,groupid:_childId,group:t,type:"AND",selected:!0,draggable:!1});whereGroupsStore=Ext.data.StoreManager.lookup("KReportDesignerWhereGroupsStore"),whereGroupsStore.add({id:r.get("groupid"),groupid:r.get("groupid"),unionid:this.unionid,parent:i.get("id"),group:t,type:"AND"}),i.isExpanded()||i.expand(),this.view.getSelectionModel().select(r)}},this)}}),Ext.define("SpiceCRM.KReporter.Designer.fields.categoryfield",{extend:"Ext.form.field.ComboBox",requires:["SpiceCRM.KReporter.Designer.model.category"],alias:["widget.categoryfield"],fieldLabel:languageGetText("LBL_ASSIGNED_CATEGORY_LABEL"),forceSelection:!0,listConfig:{minWidth:250},typeAhead:!1,loadingText:languageGetText("LBL_SEARCHING"),width:200,labelWidth:50,pageSize:10,hideTrigger:!1,triggerAction:"all",queryParam:"searchterm",listeners:{afterrender:function(e){SpiceCRM.KReporter.Common.isKReporterPro()&&this.show()}}}),Ext.define("SpiceCRM.KReporter.Designer.fields.korgfield",{extend:"Ext.form.field.ComboBox",requires:["SpiceCRM.KReporter.Designer.model.korgs"],alias:["widget.korgfield"],fieldLabel:languageGetText("LBL_KORGOBJECTS_LABEL"),forceSelection:!0,listConfig:{minWidth:250},typeAhead:!1,loadingText:languageGetText("LBL_SEARCHING"),width:200,labelWidth:50,pageSize:10,hideTrigger:!1,triggerAction:"all",queryParam:"searchterm"}),Ext.define("SpiceCRM.KReporter.Designer.fields.securitygroupfield",{extend:"Ext.form.field.ComboBox",requires:["SpiceCRM.KReporter.Designer.model.securitygroups"],alias:["widget.securitygroupfield"],fieldLabel:languageGetText("LBL_ASSIGNED_SECURITYGROUP_LABEL"),forceSelection:!0,listConfig:{minWidth:250},typeAhead:!1,loadingText:languageGetText("LBL_SEARCHING"),width:200,labelWidth:50,pageSize:10,hideTrigger:!1,triggerAction:"all",queryParam:"searchterm"}),Ext.define("SpiceCRM.KReporter.Designer.fields.teamfield",{extend:"Ext.form.field.ComboBox",requires:["SpiceCRM.KReporter.Designer.model.teams"],alias:["widget.teamfield"],fieldLabel:languageGetText("LBL_ASSIGNED_TEAM_LABEL"),forceSelection:!0,listConfig:{minWidth:250},typeAhead:!1,loadingText:languageGetText("LBL_SEARCHING"),width:200,labelWidth:50,pageSize:10,hideTrigger:!1,triggerAction:"all",queryParam:"searchterm"}),Ext.define("SpiceCRM.KReporter.Designer.fields.userfield",{extend:"Ext.form.field.ComboBox",requires:["SpiceCRM.KReporter.Designer.model.users"],alias:["widget.userfield"],fieldLabel:languageGetText("LBL_ASSIGNED_USER_LABEL"),forceSelection:!0,listConfig:{minWidth:250},typeAhead:!1,loadingText:languageGetText("LBL_SEARCHING"),width:250,labelWidth:50,hideTrigger:!1,triggerAction:"all",queryParam:"searchterm",pageSize:10}),Ext.define("SpiceCRM.KReporter.Designer.window.KReportDetails.reportOptions",{extend:"Ext.window.Window",title:languageGetText("LBL_REPORT_OPTIONS"),width:450,modal:!0,closeAction:"hide",items:[{xtype:"fieldset",title:languageGetText("LBL_AUTH_CHECK"),collapsible:!1,width:410,style:{"margin-left":"5px","margin-right":"5px"},items:[{xtype:"radiogroup",itemId:"kreportoptionsauthCheck",fieldLabel:languageGetText("LBL_AUTH_CHECK"),columns:1,items:[{boxLabel:languageGetText("LBL_AUTH_FULL"),name:"ac",inputValue:"full"},{boxLabel:languageGetText("LBL_AUTH_TOP"),name:"ac",inputValue:"top"},{boxLabel:languageGetText("LBL_AUTH_NONE"),name:"ac",inputValue:"none"}]},{xtype:"checkbox",itemId:"kreportoptionsshowDeleted",fieldLabel:languageGetText("LBL_SHOW_DELETED")}]},{xtype:"fieldset",title:languageGetText("LBL_FOLDED_PANELS"),collapsible:!1,width:410,style:{"margin-left":"5px","margin-right":"5px"},items:[{xtype:"radiogroup",itemId:"kreportoptionsdynOptions",fieldLabel:languageGetText("LBL_DYNOPTIONS"),items:[{boxLabel:languageGetText("LBL_PANEL_OPEN"),name:"dopt",inputValue:"open"},{boxLabel:languageGetText("LBL_PANEL_COLLAPSED"),name:"dopt",inputValue:"collapsed"}]}]},{xtype:"fieldset",title:languageGetText("LBL_DATA_UPDATE"),collapsible:!1,width:410,style:{"margin-left":"5px","margin-right":"5px"},items:[{xtype:"checkbox",itemId:"kreportoptionsupdateOnRequest",fieldLabel:languageGetText("LBL_UPDATE_ON_REQUEST")}]}],listeners:{show:function(){""===SpiceCRM.KReporter.Designer.Application.reportRecord.get("reportoptions")?optionsObject={}:optionsObject=Ext.decode(Ext.util.Format.htmlDecode(SpiceCRM.KReporter.Designer.Application.reportRecord.get("reportoptions"))),void 0===optionsObject.authCheck&&(optionsObject.authCheck="all"),this.down("#kreportoptionsauthCheck").setValue({ac:optionsObject.authCheck}),void 0!==optionsObject.showDeleted&&!0===optionsObject.showDeleted&&this.down("#kreportoptionsshowDeleted").setValue(!0),void 0===optionsObject.optionsFolded||"open"===optionsObject.optionsFolded?this.down("#kreportoptionsdynOptions").setValue({dopt:"open"}):this.down("#kreportoptionsdynOptions").setValue({dopt:"collapsed"}),void 0!==optionsObject.updateOnRequest&&!0===optionsObject.updateOnRequest&&this.down("#kreportoptionsupdateOnRequest").setRawValue(!0)},hide:function(){optionsObject={},optionsObject.authCheck=this.down("#kreportoptionsauthCheck").getValue().ac,optionsObject.showDeleted=this.down("#kreportoptionsshowDeleted").getValue(),optionsObject.optionsFolded=this.down("#kreportoptionsdynOptions").getValue().dopt,optionsObject.updateOnRequest=this.down("#kreportoptionsupdateOnRequest").getValue(),SpiceCRM.KReporter.Designer.Application.reportRecord.set("reportoptions",Ext.util.Format.htmlEncode(Ext.encode(optionsObject)))}}}),Ext.define("SpiceCRM.KReporter.Designer.window.KReportDetails.unionMappingPopup",{extend:"Ext.window.Window",title:languageGetText("LBL_MUTLISELECT_POPUP_TITLE"),layout:"fit",width:500,height:300,closeAction:"hide",plain:!0,draggable:!0,modal:!0,unionid:null,unionfields:null,mappingrecord:null,items:[{xtype:"gridpanel",store:Ext.create("SpiceCRM.KReporter.Designer.store.unionMappingPopupFields"),columns:[{hidden:!0,dataIndex:"fieldid"},{text:languageGetText("LBL_NAME"),dataIndex:"name",flex:1,header:languageGetText("LBL_MULTISELECT_TEXT_HEADER")},{text:languageGetText("LBL_UNIONFIELDDISPLAYPATH"),dataIndex:"unionfielddisplaypath",width:150,sortable:!1},{text:languageGetText("LBL_UNIONFIELDNAME"),dataIndex:"unionfieldname",width:150,sortable:!1}],selModel:new Ext.selection.RowModel({mode:"SINGLE"}),stripeRows:!0,autoExpandColumn:"name",height:350,width:400}],buttons:[{text:languageGetText("LBL_MUTLISELECT_CANCEL_BUTTON"),handler:function(){this.up(".window").hide()}},{text:languageGetText("LBL_MUTLISELECT_CLOSE_BUTTON"),handler:function(){this.up(".window").hide(),_unionListStore=Ext.data.StoreManager.lookup("KReportDesignerUnionListFieldsStore");var e=this.up(".window").down(".grid").getSelectionModel().getSelection(),t=_unionListStore.find("fieldid",e[0].get("fieldid")),i=_unionListStore.getAt(t),r=Ext.ComponentQuery.query("#UnionTree")[0].controller.getUnionPath();i.set("unionfieldpath",r.path+"::field:"+this.up(".window").mappingrecord.get("name")),i.set("unionfieldname",this.up(".window").mappingrecord.get("name")),i.set("unionfielddisplaypath",r.displayPath)}}],listeners:{show:function(){this.down(".grid").store.removeAll(),this.unionfields.each(function(e){this.down(".grid").store.add({fieldid:e.get("fieldid"),name:e.get("name"),unionfielddisplaypath:e.get("unionfielddisplaypath"),unionfieldname:e.get("unionfieldname")})},this)}}}),Ext.define("SpiceCRM.KReporter.Designer.view.IntegrationContainer",{extend:"Ext.panel.Panel",itemId:"integrationPluginContainer",requires:["SpiceCRM.KReporter.Designer.model.plugin"],alias:["widget.KReportDetails.IntegrationContainer"],controller:"KReportDesigner.IntegrationContainerController",width:"100%",heiht:"100%",layout:"hbox",defaults:{border:!1},items:[{xtype:"gridpanel",itemId:"integrationPluginsGridPanel",width:300,height:"100%",border:"0 1 0 0",scrollable:!0,store:Ext.create("SpiceCRM.KReporter.Designer.store.plugins",{storeId:"KReportDesignerIntegrationPluginsStore"}),viewConfig:{markDirty:!1},columns:[{text:"id",dataIndex:"id",hidden:!0},{text:languageGetText("LBL_INTEGRATION_PLUGINNAME"),dataIndex:"name",flex:1,menuDisabled:!0,resizable:!1,sortable:!1},{menuDisabled:!0,resizable:!1,sortable:!1,width:55,align:"center",dataIndex:"active",renderer:function(e){switch(e){case 1:return'<img src="modules/KReports/images/lightbulb.png"></img>';default:return'<img src="modules/KReports/images/lightbulb_off.png"></img>'}}}],split:!0},{xtype:"panel",layout:"fit",itemId:"integrationPluginEditorPanel",flex:1,height:"100%",split:!0}]}),Ext.define("SpiceCRM.KReporter.Designer.view.KReportDetails",{extend:"Ext.tab.Panel",alias:["widget.KReportDetails"],flex:3,activeTab:1,defaults:{border:!1},items:[{title:languageGetText("LBL_SELECT"),icon:"modules/KReports/images/selection.png",xtype:"KReportDetails.WhereContainer"},{title:languageGetText("LBL_MANIPULATE"),xtype:"panel",icon:"modules/KReports/images/manipulation.png",layout:"fit",items:[{xtype:"KReportDetails.listFieldsGrid"},{xtype:"KReportDetails.unionListFieldsGrid"}]},{title:languageGetText("LBL_PRESENTATION"),icon:"modules/KReports/images/presentation.png",xtype:"KReportDetails.PresentationContainer",itemId:"KReportDetailsPresentationContainer"},{title:languageGetText("LBL_VISUALIZATION"),icon:"modules/KReports/images/visualization.png",xtype:"KReportDetails.VisualizationContainer",itemId:"KReportDetailsVisualizationContainer"},{title:languageGetText("LBL_INTEGRATION"),icon:"modules/KReports/images/integration.png",xtype:"KReportDetails.IntegrationContainer",itemId:"KReportDetailsIntegrationContainer"}]}),Ext.define("SpiceCRM.KReporter.Designer.view.editorWindow",{extend:"Ext.window.Window",modal:!0,height:200,width:400,layout:"fit",record:null,editedField:null,editedFieldText:null,title:"Editor",closeAction:"hide",items:[{xtype:"textarea"}],buttons:[{text:"OK",handler:function(){var e=this.up("window");""!==e.down("textarea").getValue()?e.record.set(e.editedField,btoa(e.items.items[0].getValue())):e.record.set(e.editedField,""),e.close()}},{text:"Cancel",handler:function(){this.up("window").close()}}],listeners:{show:function(){if(this.record.get(this.editedField)){try{_editorvalue=decodeURIComponent(atob(this.record.get(this.editedField)))}catch(e){_editorvalue=atob(this.record.get(this.editedField))}this.items.items[0].setValue(_editorvalue)}else this.items.items[0].setValue("");this.setTitle(this.record.get("name")+" - "+this.editedFieldText)}}}),Ext.define("SpiceCRM.KReporter.Designer.view.KReportDetails.listFieldsGrid",{extend:"Ext.grid.Panel",require:["SpiceCRM.KReporter.Designer.controller.listFieldsController"],itemId:"KReportDetailsListFieldsGrid",controller:"KReportDesignerListFieldsController",alias:["widget.KReportDetails.listFieldsGrid"],store:Ext.create("SpiceCRM.KReporter.Designer.store.listFields",{storeId:"KReportDesignerListFieldsStore"}),flex:3,border:!1,height:"100%",columns:[{text:languageGetText("LBL_SEQUENCE"),readOnly:!0,dataIndex:"sequence",width:30,sortable:!0,hidden:!0},{text:languageGetText("LBL_FULLPATH"),readOnly:!0,dataIndex:"path",width:150,sortable:!0,hidden:!0},{text:languageGetText("LBL_PATH"),readOnly:!0,dataIndex:"displaypath",width:150,sortable:!1},{text:languageGetText("LBL_FIELDNAME"),dataIndex:"fieldname",sortable:!1,width:150,hidden:!0},{text:languageGetText("LBL_NAME"),dataIndex:"name",sortable:!1,width:150,editor:{xtype:"textfield"}},{text:languageGetText("LBL_JOIN_TYPE"),readOnly:!0,dataIndex:"jointype",width:170,sortable:!0,hidden:!1,editor:{xtype:"kcombo",listConfig:{minWidth:170},typeAhead:!0,triggerAction:"all",mode:"local",store:Ext.create("Ext.data.Store",{fields:["value","text"],data:[{value:"optional",text:languageGetText("LBL_JT_OPTIONAL")},{value:"required",text:languageGetText("LBL_JT_REQUIRED")}]}),valueField:"value",displayField:"text"},renderer:function(e){return void 0!==e&&"-"!==e?languageGetText("LBL_JT_"+e.toUpperCase()):e}},{text:languageGetText("LBL_SQLFUNCTION"),readOnly:!0,dataIndex:"sqlfunction",width:150,sortable:!1,hidden:!1,editor:{xtype:"kcombo",listConfig:{minWidth:150},typeAhead:!0,triggerAction:"all",mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[["-","-"],["SUM",languageGetText("LBL_FUNCTION_SUM")],["COUNT",languageGetText("LBL_FUNCTION_COUNT")],["COUNT_DISTINCT",languageGetText("LBL_FUNCTION_COUNT_DISTINCT")],["MAX",languageGetText("LBL_FUNCTION_MAX")],["MIN",languageGetText("LBL_FUNCTION_MIN")],["AVG",languageGetText("LBL_FUNCTION_AVG")],["GROUP_CONCAT",languageGetText("LBL_FUNCTION_GROUP_CONCAT")],["GROUP_CONASC",languageGetText("LBL_FUNCTION_GROUP_CONASC")],["GROUP_CONDSC",languageGetText("LBL_FUNCTION_GROUP_CONDSC")]]}),valueField:"value",displayField:"text"},renderer:function(e){return void 0!==e&&"-"!==e?languageGetText("LBL_FUNCTION_"+e.toUpperCase()):e}},{text:languageGetText("LBL_CUSTOMSQLFUNCTION"),readOnly:!0,itemId:"customsqlfunction",dataIndex:"customsqlfunction",width:70,sortable:!1,hidden:!1,editor:{xtype:"textfield"},renderer:function(t){if(!t||""===t||null===t)return t;try{_tbfvalue=decodeURIComponent(atob(t))}catch(e){_tbfvalue=atob(t)}return Ext.util.Format.htmlEncode(_tbfvalue)}},{text:languageGetText("LBL_GROUPING"),readOnly:!0,dataIndex:"grouping",width:150,sortable:!1,hidden:!1,editor:{xtype:"kcombo",store:Ext.create("SpiceCRM.KReporter.Designer.store.buckets",{storeId:"KReportDesignerBucketsStore"}),listConfig:{minWidth:150},typeAhead:!0,triggerAction:"all",mode:"local",valueField:"id",displayField:"name"},renderer:function(e){var t=Ext.data.StoreManager.lookup("KReportDesignerBucketsStore");return e&&t?t.getById(e).get("name"):e}},{text:languageGetText("LBL_VALUETYPE"),readOnly:!0,dataIndex:"valuetype",width:100,sortable:!1,hidden:!1,editor:{xtype:"kcombo",listConfig:{minWidth:100},typeAhead:!0,triggerAction:"all",lazyRender:!1,mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[["-","-"],["TOFSUM",languageGetText("LBL_VALUETYPE_TOFSUM")],["POFSUM",languageGetText("LBL_VALUETYPE_POFSUM")],["POFCOUNT",languageGetText("LBL_VALUETYPE_POFCOUNT")],["POFAVG",languageGetText("LBL_VALUETYPE_POFAVG")],["DOFSUM",languageGetText("LBL_VALUETYPE_DOFSUM")],["DOFCOUNT",languageGetText("LBL_VALUETYPE_DOFCOUNT")],["DOFAVG",languageGetText("LBL_VALUETYPE_DOFAVG")],["C",languageGetText("LBL_VALUETYPE_C")]]}),valueField:"value",displayField:"text"},renderer:function(e){return e&&void 0!==e&&"-"!==e&&""!==e?languageGetText("LBL_VALUETYPE_"+e.toUpperCase()):e}},{text:languageGetText("LBL_GROUPBY"),readOnly:!0,dataIndex:"groupby",width:100,sortable:!0,hidden:!1,editor:{xtype:"kcombo",typeAhead:!1,triggerAction:"all",editable:!1,mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[["no",languageGetText("LBL_NO")],["yes",languageGetText("LBL_YES")]]}),valueField:"value",displayField:"text"},renderer:function(e){return void 0!==e?languageGetText("LBL_"+e.toUpperCase()):e}},{text:languageGetText("LBL_FIXEDVALUE"),dataIndex:"fixedvalue",sortable:!1,width:80,editor:{xtype:"textfield"}},{text:languageGetText("LBL_ASSIGNTOVALUE"),dataIndex:"assigntovalue",sortable:!1,width:60,editor:{xtype:"textfield"},hidden:!1},{itemId:"formulavalue",text:languageGetText("LBL_FORMULAVALUE"),dataIndex:"formulavalue",sortable:!1,width:170,editor:{xtype:"textfield",listeners:{focus:function(e){void 0!==e.getValue()&&""!==e.getValue()&&e.setValue(K.kreports.decode64(e.getValue()))}}},renderer:function(t){if(!t||""===t||null===t)return t;try{_tbfvalue=decodeURIComponent(atob(t))}catch(e){_tbfvalue=atob(t)}return Ext.util.Format.htmlEncode(_tbfvalue)},hidden:!1},{text:languageGetText("LBL_FORMULASEQUENCE"),dataIndex:"formulasequence",sortable:!1,width:70,editor:{xtype:"numberfield",anchor:"100%",allowDecimals:!1},hidden:!1}],viewConfig:{markDirty:!1,plugins:{ptype:"gridviewdragdrop",dropGroup:"designerfields",dragGroup:"designerfields",enableDrag:!0},listeners:{beforedrop:"onBeforeDrop",scope:"controller"}},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,listeners:{beforeedit:function(e,t){if("formulavalue"===t.column.itemId||"customsqlfunction"===t.column.itemId)return SpiceCRM.KReporter.Designer.view.KReportDetails.editorWindow.record=t.record,SpiceCRM.KReporter.Designer.view.KReportDetails.editorWindow.editedField=t.column.itemId,SpiceCRM.KReporter.Designer.view.KReportDetails.editorWindow.editedFieldText=t.column.text,SpiceCRM.KReporter.Designer.view.KReportDetails.editorWindow.show(),!1}}})],dockedItems:[{xtype:"toolbar",dock:"top",defaults:{padding:"5px 2px"},items:[{text:languageGetText("LBL_ADDEMTPY_BUTTON_LABEL"),icon:"modules/KReports/images/add.png",itemId:"kreportsdesignerlistgridaddfixedbutton"},{text:languageGetText("LBL_DELETE_BUTTON_LABEL"),icon:"modules/KReports/images/delete.png",itemId:"kreportsdesignerlistgriddeletefieldbutton"},"-",{xtype:"numberfield",width:200,allowDecimals:!1,minValue:0,fieldLabel:languageGetText("LBL_SELECTION_LIMIT"),itemId:"listgridSelectionLimit",listeners:{afterrender:function(e){if(SpiceCRM.KReporter.Designer.Application.reportRecord.get("selectionlimit")){var t=SpiceCRM.KReporter.Designer.Application.reportRecord.get("selectionlimit").split(" ");e.setValue(t[0])}},change:function(e){e.getValue()&&this.up().down("#listgridSelectionLimType")?this.up().down("#listgridSelectionLimType").getValue()&&SpiceCRM.KReporter.Designer.Application.reportRecord.set("selectionlimit",e.getValue()+" "+this.up().down("#listgridSelectionLimType")):SpiceCRM.KReporter.Designer.Application.reportRecord.set("selectionlimit","")}}},{xtype:"combobox",itemId:"listgridSelectionLimType",typeAhead:!0,triggerAction:"all",width:105,lazyRender:!0,value:"",mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[["","-"],["r",languageGetText("LBL_RECORDS")],["p",languageGetText("LBL_PERCENTAGE")]]}),valueField:"value",displayField:"text",listeners:{afterrender:function(e){if(SpiceCRM.KReporter.Designer.Application.reportRecord.get("selectionlimit")){var t=SpiceCRM.KReporter.Designer.Application.reportRecord.get("selectionlimit").split(" ");e.setValue(t[1])}},change:function(e){e.getValue()&&this.up().down("#listgridSelectionLimit")&&(this.up().down("#listgridSelectionLimit").getValue()?SpiceCRM.KReporter.Designer.Application.reportRecord.set("selectionlimit",this.up().down("#listgridSelectionLimit")+" "+e.getValue()):SpiceCRM.KReporter.Designer.Application.reportRecord.set("selectionlimit",""))}}}]}]}),Ext.define("SpiceCRM.KReporter.Designer.view.main.Main",{extend:"Ext.container.Container",requires:["SpiceCRM.KReporter.Designer.controller.MainController"],xtype:"app-main",renderTo:"kreportdesigner",height:"100%",border:!1,controller:"KReportDesignerMain",layout:{type:"border"},style:{"background-color":"transparent"},items:[{xtype:"designerMainToolbar",region:"north",margin:"0 0 10 0"},{xtype:"moduleSelector",region:"west",width:250,margin:"0 0 0 0",split:!0},{xtype:"KReportDetails",region:"center"}]}),Ext.define("SpiceCRM.KReporter.Designer.view.maintoolbar",{extend:"Ext.Toolbar",optionsWindow:null,controller:"KReportDesignerMainToolbar",alias:["widget.designerMainToolbar"],initialize:function(){},lockAll:function(){},items:[{xtype:"button",itemId:"save",text:languageGetText("LBL_SAVE_BUTTON_LABEL"),icon:"modules/KReports/images/save.png",disabled:!1},{xtype:"button",itemId:"cancel",text:languageGetText("LBL_CANCEL_BUTTON_LABEL"),icon:"modules/KReports/images/cancel.png",disabled:!1},"-",{xtype:"textfield",itemId:"reportname",width:200,labelWidth:50,fieldLabel:languageGetText("LBL_REPORT_NAME_LABEL"),setName:function(e,t){},listeners:{beforerender:function(){this.setValue(SpiceCRM.KReporter.Designer.Application.reportRecord.get("name"))},change:function(){SpiceCRM.KReporter.Designer.Application.reportRecord.set("name",this.getValue())}}},{xtype:"button",icon:"modules/KReports/images/longtext.png",handler:function(){SpiceCRM.KReporter.Designer.view.maintoolbar.descriptionTextArea=new Ext.form.HtmlEditor({}),SpiceCRM.KReporter.Designer.view.maintoolbar.descriptionPopupwin=new Ext.Window({layout:"fit",width:600,height:400,closeAction:"close",plain:!0,title:"Description",items:SpiceCRM.KReporter.Designer.view.maintoolbar.descriptionTextArea,listeners:{beforeclose:function(){SpiceCRM.KReporter.Designer.Application.reportRecord.set("description",SpiceCRM.KReporter.Designer.view.maintoolbar.descriptionTextArea.getValue())}}}),SpiceCRM.KReporter.Designer.view.maintoolbar.descriptionTextArea.setValue(SpiceCRM.KReporter.Designer.Application.reportRecord.get("description")),SpiceCRM.KReporter.Designer.view.maintoolbar.descriptionPopupwin.show()},disabled:!1},"-",{xtype:"userfield",store:Ext.create("SpiceCRM.KReporter.Designer.store.users",{storeId:"KReportDesignerUsersStore"}),displayField:"name",valueField:"id",itemId:"assigneduserid",queryMode:"remote"},{xtype:"teamfield",hidden:void 0===SUGAR.App,store:{type:"KReportDesignerTeams",storeId:"KReportDesignerTeamsStore"},displayField:"name",valueField:"id",itemId:"assignedteamid"},{xtype:"korgfield",hidden:!0,store:{type:"KReportDesignerKOrgs",storeId:"KReportDesignerKOrgsStore"},displayField:"name",valueField:"id",itemId:"assignedkorgid"},{xtype:"securitygroupfield",hidden:!0,store:{type:"KReportDesignerSecurityGroups",storeId:"KReportDesignerSecurityGroupsStore"},displayField:"name",valueField:"id",itemId:"assignedsecuritygroupid"},"-",{xtype:"categoryfield",hidden:!0,store:{type:"KReportDesignerCategories",storeId:"KReportDesignerCategoriesStore"},displayField:"name",valueField:"id",itemId:"assignedcategoryid"},{xtype:"numberfield",itemId:"assignedcategorypriority",hidden:!SpiceCRM.KReporter.Common.isKReporterCockpit(),width:100,labelWidth:20,fieldLabel:languageGetText("LBL_CATEGORIES_PRIORITY")},"-",{text:languageGetText("LBL_REPORT_OPTIONS"),icon:"modules/KReports/images/tools.png",handler:function(){var e=this.up("toolbar");e.optionsWindow||(e.optionsWindow=Ext.create("SpiceCRM.KReporter.Designer.window.KReportDetails.reportOptions")),e.optionsWindow.show()}},"->",{xtype:"tbtext",itemId:"repVersion",text:atob(SpiceCRM.KReporter.versionstring),style:{fontWeight:"bold",fontStyle:"italic"}},{xtype:"tbitem",html:atob(SpiceCRM.KReporter.icon1string)+"&nbsp;"+atob(SpiceCRM.KReporter.icon2string),style:{display:"inline-flex"}}]}),Ext.define("SpiceCRM.KReporter.Designer.view.SubPanelFields.FieldListGrid",{extend:"Ext.grid.Panel",alias:["widget.KreportDesignerFields.FieldListGrid"],requires:["SpiceCRM.KReporter.Designer.controller.SubPanelFieldlistController"],controller:"KReportDesigner.FieldllistController",store:Ext.create("SpiceCRM.KReporter.Designer.store.fields",{storeId:"KreportDesignerFieldListStore"}),flex:1,height:"100%",columns:[{text:"Field",dataIndex:"name",flex:1},{text:"Name",dataIndex:"text",flex:1}],viewConfig:{scrollable:!0,stripeRows:!0,copy:!0,plugins:{ptype:"gridviewdragdrop",dragGroup:"designerfields",enableDrop:!1}},tbar:[{xtype:"textfield",itemId:"fieldFilter",width:"100%"}]}),Ext.define("SpiceCRM.KReporter.Designer.view.moduleSelector",{extend:"Ext.Panel",alias:["widget.moduleSelector"],layout:"vbox",border:!1,items:[{xtype:"panel",layout:"accordion",width:"100%",margin:"0 0 0 0",flex:2,padding:0,items:[{xtype:"ModuleTree"},{xtype:"UnionTree"}],split:!0},{xtype:"KreportDesignerFields.FieldListGrid",width:"100%",flex:2,margin:"0 0 0 0",split:!0}]}),Ext.define("SpiceCRM.KReporter.Designer.view.SubPanelFields.ModuleTreeGrid",{extend:"Ext.tree.Panel",alias:["widget.ModuleTree"],requires:["SpiceCRM.KReporter.Designer.controller.ModuleTreeController"],itemId:"ModuleTreeGrid",controller:"ModuleTreeController",title:"Module",store:Ext.create("SpiceCRM.KReporter.Designer.store.moduletree",{storeId:"moduletree"}),flex:1,height:"100%",width:"100%",border:!1,columns:[{xtype:"treecolumn",text:"module",dataIndex:"module",flex:1},{text:"name",dataIndex:"name",flex:1,hidden:!0},{text:"link",dataIndex:"link",flex:1,hidden:!0}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"combo",width:"100%",store:Ext.create("SpiceCRM.KReporter.Designer.store.modules",{storeId:"KReportDesignerModuleStore"}),displayField:"name",valueField:"module",text:"modules",forceSelection:!0,itemId:"mainModuleSelector",editable:!0,selectOnFocus:!0,typeAhead:!0,minChars:3,allowBlank:!1,emptyText:languageGetText("LBL_SELECT_MODULE"),triggerAction:"all",valuePublishEvent:"select",queryMode:"local"}]}],bufferedRenderer:!1,rootVisible:!1,root:{name:"mainrootnode",expanded:!1,id:"mainrootnode"}}),Ext.define("SpiceCRM.KReporter.Designer.view.PresentationContainer",{extend:"Ext.panel.Panel",itemId:"presentationPluginContainer",alias:["widget.KReportDetails.PresentationContainer"],controller:"KReportDesigner.PresentationContainerController",items:[],width:"100%",layout:"fit",border:!1,dockedItems:[{xtype:"toolbar",dock:"top",defaults:{padding:"5px 2px"},items:[{xtype:"combobox",itemId:"presentationPluginCombo",fieldLabel:languageGetText("LBL_PRESENTATION_PLUGIN"),triggerAction:"all",width:300,labelWidth:80,lazyRender:!1,mode:"local",store:Ext.create("SpiceCRM.KReporter.Designer.store.plugins",{storeId:"KReportDesignerPresentationPluginsStore"}),valueField:"id",displayField:"name"}]}]}),Ext.define("SpiceCRM.KReporter.Designer.view.KReportDetails.unionListFieldsGrid",{extend:"Ext.grid.Panel",require:["SpiceCRM.KReporter.Designer.controller.unionListFieldsController"],controller:"KReportDesignerUnionListFieldsController",alias:["widget.KReportDetails.unionListFieldsGrid"],hidden:!0,itemId:"KReportDetailsUnionListFieldsGrid",store:Ext.create("SpiceCRM.KReporter.Designer.store.unionListFields",{storeId:"KReportDesignerUnionListFieldsStore"}),title:"Union fields",flex:3,height:"100%",columns:[{text:languageGetText("LBL_PATH"),dataIndex:"displaypath",width:150,sortable:!1},{text:languageGetText("LBL_NAME"),dataIndex:"fieldid",sortable:!1,width:100,renderer:function(e){if(e){var t=Ext.data.StoreManager.lookup("KReportDesignerListFieldsStore").findRecord("fieldid",e);if(t)return t.get("name")}return e}},{text:"unionfieldpath",dataIndex:"unionfieldpath",width:100},{text:languageGetText("LBL_UNIONFIELDDISPLAYPATH"),dataIndex:"unionfielddisplaypath",width:150,sortable:!1},{text:languageGetText("LBL_UNIONFIELDNAME"),dataIndex:"unionfieldname",width:100,sortable:!1},{text:languageGetText("LBL_FIXEDVALUE"),dataIndex:"fixedvalue",sortable:!1,width:80,editor:{xtype:"textfield"}}],viewConfig:{markDirty:!1,stripeRows:!0,plugins:{ptype:"gridviewdragdrop",dropGroup:"designerfields",enableDrag:!1},listeners:{beforedrop:"onBeforeDrop",scope:"controller"}},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],sm:new Ext.selection.RowModel}),Ext.define("SpiceCRM.KReporter.Designer.view.SubPanelFields.UnionTree",{extend:"Ext.tree.Panel",alias:["widget.UnionTree"],disabled:!0,requires:["SpiceCRM.KReporter.Designer.controller.UnionTreeController"],itemId:"UnionTree",controller:"UnionTreeController",title:"Union",store:Ext.create("SpiceCRM.KReporter.Designer.store.unionModules",{storeId:"kreportdesginerUnionModules"}),flex:1,height:"100%",width:"100%",columns:[{xtype:"treecolumn",text:"module",dataIndex:"module",flex:1},{text:"name",dataIndex:"name",flex:1,hidden:!0},{text:"link",dataIndex:"link",flex:1,hidden:!0}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"combo",store:Ext.create("SpiceCRM.KReporter.Designer.store.modules",{storeId:"KReportDesignerModuleStore"}),itemId:"unionModuleSelector",displayField:"name",valueField:"module",text:"modules",queryMode:"local",emptyText:languageGetText("LBL_SELECT_MODULE")},{xtype:"button",icon:"modules/KReports/images/add.png",disabled:!0,itemId:"unionModuleAddButton"},{xtype:"button",icon:"modules/KReports/images/delete.png",disabled:!0,itemId:"unionModuleDelButton"}]}],bufferedRenderer:!1,rootVisible:!1,root:{name:"rootnode",expanded:!0}}),Ext.define("SpiceCRM.KReporter.Designer.view.VisualizationContainer",{extend:"Ext.panel.Panel",itemId:"KReportDesginerVisualizationPluginContainer",alias:["widget.KReportDetails.VisualizationContainer"],controller:"KReportDesigner.VisualizationContainerController",items:[],width:"100%",layout:"fit",dockedItems:[{xtype:"toolbar",dock:"top",defaults:{padding:"5px 2px"},items:[{xtype:"combobox",itemId:"layoutCombo",store:Ext.create("SpiceCRM.KReporter.Designer.store.layouts","kreportdesignerLayoutsStore").load(),valueField:"name",displayField:"name",width:170,labelWidth:70,fieldLabel:languageGetText("LBL_VISUALIZATIONTOOLBAR_LAYOUT"),editable:!1,queryMode:"local",triggerAction:"all",value:"-"},{xtype:"tbseparator"},{xtype:"spinnerfield",itemId:"vizHeightSpinner",value:300,max:1e3,step:50,min:100,editable:!1,width:150,labelWidth:70,fieldLabel:languageGetText("LBL_VISUALIZATION_HEIGHT"),disabled:!0,onSpinUp:function(){var e=this;if(!e.readOnly){var t=parseInt(e.getValue());t==e.max?e.setValue(e.min):e.setValue(t+e.step)}},onSpinDown:function(){var e=this;if(!e.readOnly){var t=parseInt(e.getValue());t==e.min?e.setValue(e.max):e.setValue(t-e.step)}}},{xtype:"spinnerfield",itemId:"chartSpinner",value:0,max:0,editable:!1,width:150,labelWidth:50,fieldLabel:"Item",disabled:!0,setMaxValue:function(e){this.max=parseInt(e),parseInt(this.getValue())>parseInt(e)&&(this.setValue(e),this.up("panel").getController().switchPanelToIndex(e)),0===parseInt(this.getValue())&&0<e&&(this.setValue(1),this.up("panel").getController().switchPanelToIndex(1))}},{xtype:"combobox",itemId:"visualizationPluginCombo",fieldLabel:languageGetText("LBL_PRESENTATION_PLUGIN"),triggerAction:"all",width:300,disabled:!0,labelWidth:80,lazyRender:!1,mode:"local",editable:!1,store:Ext.create("SpiceCRM.KReporter.Designer.store.plugins",{storeId:"KReportDesignerVisualizationPluginsStore"}),valueField:"id",displayField:"name"}]}]}),Ext.define("SpiceCRM.KReporter.Designer.view.KReportDetails.WhereClausesGrid",{extend:"Ext.grid.Panel",itemId:"KReportDetailsWhereClausesGrid",controller:"KReportDesignerWhereClauseController",alias:["widget.KReportDetails.WhereClauseGrid"],store:Ext.create("SpiceCRM.KReporter.Designer.store.whereclauses",{storeId:"KReportDesignerWhereClausesStore"}),flex:3,width:"100%",columns:[{text:languageGetText("LBL_PATH"),readOnly:!0,dataIndex:"displaypath",width:150,sortable:!0,hidden:!1},{text:languageGetText("LBL_FULLPATH"),readOnly:!0,dataIndex:"path",width:150,sortable:!0,hidden:!0},{text:languageGetText("LBL_SEQUENCE"),dataIndex:"sequence",sortable:!0,editor:new Ext.form.TextField,width:70},{text:languageGetText("LBL_EXPORTPDF"),dataIndex:"exportpdf",sortable:!0,hidden:!0,renderer:function(e,t,i,r,o,n){return""!==e?languageGetText("LBL_UEOPTION_"+e.toUpperCase()):e},editor:new SpiceCRM.KReporter.kcombo({typeAhead:!0,triggerAction:"all",mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[["no",languageGetText("LBL_UEOPTION_NO")],["yes",languageGetText("LBL_UEOPTION_YES")]]}),displayField:"text",valueField:"value"}),width:60},{text:languageGetText("LBL_NAME"),dataIndex:"name",sortable:!0,editor:new Ext.form.TextField,width:150},{text:languageGetText("LBL_FIXEDVALUE"),dataIndex:"fixedvalue",sortable:!0,editor:new Ext.form.TextField,width:150},{itemId:"type",text:languageGetText("LBL_TYPE"),dataIndex:"type",sortable:!1,hidden:!0,width:50},{text:languageGetText("LBL_GROUPING"),readOnly:!0,dataIndex:"grouping",width:150,sortable:!1,hidden:!1,editor:{xtype:"kcombo",store:Ext.create("SpiceCRM.KReporter.Designer.store.buckets",{storeId:"KReportDesignerBucketsWhereStore"}),listConfig:{minWidth:150},typeAhead:!0,triggerAction:"all",mode:"local",valueField:"id",displayField:"name"},renderer:function(e){return e?Ext.data.StoreManager.lookup("KReportDesignerBucketsWhereStore").getById(e).get("name"):e}},{itemId:"operator",text:languageGetText("LBL_OPERATOR"),readOnly:!0,dataIndex:"operator",width:200,sortable:!0,hidden:!1,renderer:function(e,t,i,r,o,n){return languageGetText("LBL_OP_"+e.toUpperCase())},editor:new Ext.form.TextField},{itemId:"value",text:languageGetText("LBL_VALUE_FROM"),dataIndex:"value",sortable:!0,hidden:!1,width:200,editor:new Ext.form.TextField},{itemId:"valueto",text:languageGetText("LBL_VALUE_TO"),dataIndex:"valueto",sortable:!0,hidden:!1,width:200,editor:new Ext.form.TextField},{text:languageGetText("LBL_JOIN_TYPE"),readOnly:!0,dataIndex:"jointype",width:80,sortable:!0,hidden:!1,renderer:function(e,t,i,r,o,n){return e},editor:new SpiceCRM.KReporter.kcombo({typeAhead:!0,triggerAction:"all",mode:"local",store:new Ext.data.ArrayStore({fields:["jointype"],data:[["required"],["optional"]]}),displayField:"jointype"})},{text:languageGetText("LBL_USEREDITABLE"),readOnly:!0,dataIndex:"usereditable",width:80,sortable:!0,hidden:!1,renderer:function(e,t,i,r,o,n){return languageGetText("LBL_UEOPTION_"+e.toUpperCase())},editor:new SpiceCRM.KReporter.kcombo({typeAhead:!0,triggerAction:"all",mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[["yes",languageGetText("LBL_UEOPTION_YES")],["yfo",languageGetText("LBL_UEOPTION_YFO")],["yo1",languageGetText("LBL_UEOPTION_YO1")],["yo2",languageGetText("LBL_UEOPTION_YO2")],["no",languageGetText("LBL_UEOPTION_NO")]]}),displayField:"text",valueField:"value"})},{text:languageGetText("LBL_DASHLETEDITABLE"),readOnly:!0,hidden:!0,dataIndex:"dashleteditable",width:50,sortable:!0,renderer:function(e,t,i,r,o,n){return languageGetText("LBL_DEOPTION_"+e.toUpperCase())},editor:new SpiceCRM.KReporter.kcombo({typeAhead:!0,triggerAction:"all",mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[["yes",languageGetText("LBL_DEOPTION_YES")],["no",languageGetText("LBL_DEOPTION_NO")]]}),displayField:"text",valueField:"value"})},{text:languageGetText("LBL_QUERYCONTEXT"),dataIndex:"context",sortable:!0,hidden:!1,width:150,editor:new Ext.form.TextField},{text:languageGetText("LBL_QUERYREFERENCE"),dataIndex:"reference",sortable:!0,hidden:!1,width:150,editor:new Ext.form.TextField}],sm:new Ext.selection.RowModel,viewConfig:{markDirty:!1,stripeRows:!0,plugins:{ptype:"gridviewdragdrop",dropGroup:"designerfields",enableDrag:!0},listeners:{beforedrop:"onBeforeDrop",scope:"controller"}},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],tbar:[{xtype:"button",text:languageGetText("LBL_DELETE_BUTTON_LABEL"),itemId:"WhereClauseDeleteButton",disabled:!0}]}),Ext.define("SpiceCRM.KReporter.Designer.view.WhereContainer",{extend:"Ext.panel.Panel",itemId:"whereContainer",alias:["widget.KReportDetails.WhereContainer"],width:"100%",heigth:"100%",layout:"vbox",items:[{xtype:"WhereTreeGrid",split:!0},{xtype:"KReportDetails.WhereClauseGrid",split:!0}]}),Ext.define("SpiceCRM.KReporter.Designer.view.SubPanelFields.WhereTree",{extend:"Ext.tree.Panel",alias:["widget.WhereTreeGrid"],requires:["SpiceCRM.KReporter.Designer.controller.ModuleTreeController"],itemId:"WhereTreeGrid",border:!1,controller:"KReportDesignerWhereTreeController",store:Ext.create("SpiceCRM.KReporter.Designer.store.wheretreeitems",{storeId:"KReportDesignerWhereTreeStore"}),flex:1,width:"100%",plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],viewConfig:{markDirty:!1},columns:{items:[{xtype:"treecolumn",text:"group",dataIndex:"group"},{text:"type",dataIndex:"type",sortable:!1,editor:{xtype:"kcombo",typeAhead:!1,editable:!0,selectOnFocus:!0,allowBlank:!1,forceSelection:!0,triggerAction:"all",itemId:"WhereGroupOperator",mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[["AND",languageGetText("LBL_AND")],["OR",languageGetText("LBL_OR")]]}),valueField:"value",displayField:"text"}}],defaults:{flex:1}},dockedItems:[],bufferedRenderer:!1,rootVisible:!0,root:{group:"root",type:"AND"},tbar:[{xtype:"button",text:languageGetText("LBL_ADD_BUTTON_LABEL"),itemId:"WhereGroupAddButton"},{xtype:"button",text:languageGetText("LBL_DELETE_BUTTON_LABEL"),itemId:"WhereGroupDeleteButton",disabled:!0}],setRoot:function(e){var t=this.getRootNode();t.removeAll(),t.set("id",e),t.set("groupid",e),Ext.data.StoreManager.lookup("KReportDesignerWhereGroupsStore").buildTree(t,e),this.setSelection(t),t.expand(!0)}}),Ext.enableAriaButtons=!1,Ext.define("SpiceCRM.KReporter.Designer.Application",{namespaces:["SpiceCRM.KReporter.Designer"],controllers:["Application"],extend:"Ext.app.Application",name:"SpiceCRM.KReporter.Designer",reportRecord:Ext.create("SpiceCRM.KReporter.Designer.model.KReporterRecord"),thisMainView:!1,launch:function(){SpiceCRM.KReporter.Designer.Application=this,SpiceCRM.KReporter.Designer.Application.designMode=!0,SpiceCRM.KReporter.designMode=!0,this.thisMainView&&this.destroyMainView(),SpiceCRM.KReporter.Common.getConfig();var a=Ext.create("SpiceCRM.KReporter.Designer.store.wheregroups",{storeId:"KReportDesignerWhereGroupsStore"}),e="";(window.thisKreportRecord?"new"!==window.thisKreportRecord&&(e=window.thisKreportRecord):""===e&&$("#EditView")[0]&&$("#EditView")[0].record.value&&(e=$("#EditView")[0].record.value),Ext.data.StoreManager.lookup("KreportDesignerFieldListStore").removeAll(),Ext.data.StoreManager.lookup("KreportDesignerFieldListStore").clearFilter(),Ext.create("SpiceCRM.KReporter.Designer.store.dlists"),SpiceCRM.KReporter.Designer.view.KReportDetails.editorWindow=Ext.create("SpiceCRM.KReporter.Designer.view.editorWindow",{}),e)?Ext.Ajax.request({url:"KREST/module/KReports/"+e,method:"GET",success:function(e,t){var i=Ext.decode(e.responseText);SpiceCRM.KReporter.Designer.Application.reportRecord=Ext.create("SpiceCRM.KReporter.Designer.model.KReporterRecord",i),SpiceCRM.KReporter.config.securitygroups&&Ext.Ajax.request({url:"KREST/KReporter/securitygroups/get/"+SpiceCRM.KReporter.Designer.Application.reportRecord.get("id"),method:"GET",async:!1,success:function(e,t){var i=Ext.decode(e.responseText);i.securitygroup_id&&(SpiceCRM.KReporter.Designer.Application.reportRecord.set("securitygroup_id",i.securitygroup_id),SpiceCRM.KReporter.Designer.Application.reportRecord.set("securitygroup_name",i.securitygroup_name))},scope:this}),this.render();var r=Ext.data.StoreManager.lookup("KReportDesignerListFieldsStore");r.removeAll(),r.addFromReportRecord(Ext.decode(Ext.util.Format.htmlDecode(i.listfields)));var o=Ext.data.StoreManager.lookup("KReportDesignerWhereClausesStore");if(o.removeAll(),o.addFromReportRecord(Ext.decode(Ext.util.Format.htmlDecode(i.whereconditions))),a.addFromReportRecord(Ext.decode(Ext.util.Format.htmlDecode(i.wheregroups))),""!==i.union_modules){var n=Ext.ComponentQuery.query("UnionTree")[0];Ext.each(Ext.decode(Ext.util.Format.htmlDecode(i.union_modules)),function(e){n.getRootNode().appendChild({id:e.unionid,unionid:e.unionid,module:e.module,path:"union"+e.unionid+":"+e.module,selected:!0,draggable:!1}),n.getRootNode().expand()}),_unionFieldStore=Ext.data.StoreManager.lookup("KReportDesignerUnionListFieldsStore"),_unionFieldStore.removeAll(),_unionFieldStore.add(Ext.decode(Ext.util.Format.htmlDecode(i.unionlistfields)))}Ext.ComponentQuery.query("#WhereTreeGrid")[0].setRoot("root"),i.report_module&&Ext.ComponentQuery.query("#mainModuleSelector")[0].fireEvent("initialize",Ext.ComponentQuery.query("#mainModuleSelector")[0],i.report_module),this.loadPlugins()},failure:function(e,t){console.log("server-side failure with status code "+e.status)},scope:this}):(a.add({unionid:"root",id:"root",groupid:"root",type:"AND",parent:"-",notexists:""}),SpiceCRM.KReporter.Designer.Application.reportRecord=Ext.create("SpiceCRM.KReporter.Designer.model.KReporterRecord"),SpiceCRM.KReporter.Designer.Application.reportRecord.set("id",Ext.create(Ext.data.identifier.Uuid).generate()),SpiceCRM.KReporter.Designer.Application.reportRecord.set("name","new Report"),SpiceCRM.KReporter.Designer.Application.reportRecord.set("newWithId",!0),this.render(),Ext.data.StoreManager.lookup("KReportDesignerListFieldsStore").removeAll(),Ext.data.StoreManager.lookup("KReportDesignerWhereClausesStore").removeAll(),Ext.data.StoreManager.lookup("KReportDesignerUnionListFieldsStore").removeAll(),Ext.ComponentQuery.query("#WhereTreeGrid")[0].setRoot("root"),this.loadPlugins())},destroyMainView:function(){this.thisMainView.destroy(),this.thisMainView=!1,this.reportRecord=Ext.create("SpiceCRM.KReporter.Designer.model.KReporterRecord")},render:function(){this.thisMainView=Ext.create("SpiceCRM.KReporter.Designer.view.main.Main"),Ext.get(window).on({resize:function(){SpiceCRM.KReporter.Designer.Application.thisMainView&&SpiceCRM.KReporter.Designer.Application.thisMainView.updateLayout()}})},loadPlugins:function(){Ext.Ajax.request({url:"KREST/KReporter/plugins",method:"GET",params:{addData:Ext.encode(["sysinfo"])},success:function(e,t){var i=Ext.decode(e.responseText);i.addData&&i.addData.sysinfo&&(this.sysinfo=i.addData.sysinfo,Ext.globalEvents.fireEvent("designersysinfo",this.sysinfo,i)),this.presentationPluginsStore=Ext.data.StoreManager.lookup("KReportDesignerPresentationPluginsStore"),this.presentationPluginsStore.removeAll(),Ext.Object.each(i.presentation,function(e,t){t.metadata.includes.edit&&this.presentationPluginsStore.add({id:e,name:languageGetText(t.displayname),panel:t.metadata.pluginpanel,loaded:!1,plugindirectory:t.plugindirectory,include:t.plugindirectory+"/"+t.metadata.includes.edit})},this),this.visualizationPluginsStore=Ext.data.StoreManager.lookup("KReportDesignerVisualizationPluginsStore"),this.visualizationPluginsStore.removeAll(),Ext.Object.each(i.visualization,function(e,t){this.visualizationPluginsStore.add({id:e,name:languageGetText(t.displayname),panel:t.metadata.pluginpanel,loaded:!1,plugindirectory:t.plugindirectory,include:t.plugindirectory+"/"+t.metadata.includes.edit})},this),this.integrationPluginsStore=Ext.data.StoreManager.lookup("KReportDesignerIntegrationPluginsStore"),this.integrationPluginsStore.removeAll();var r={},o=Ext.util.Format.htmlDecode(SpiceCRM.KReporter.Designer.Application.reportRecord.get("integration_params"));o&&""!==o&&(r=Ext.decode(o)),Ext.Object.each(i.integration,function(e,t){this.integrationPluginsStore.add({id:e,name:languageGetText(t.displayname),panel:t.metadata&&t.metadata.includes&&t.metadata.includes.editPanel?t.metadata.includes.editPanel:void 0,loaded:!1,active:!r.activePlugins||"1"!==r.activePlugins[e]&&1!=r.activePlugins[e]?0:1,plugindirectory:t.plugindirectory,include:t.metadata&&t.metadata.includes&&t.metadata.includes.edit?t.plugindirectory+"/"+t.metadata.includes.edit:""})},this),Ext.globalEvents.fireEvent("designerPluginsLoaded")},failure:function(e,t){console.log("server-side failure with status code "+e.status)},scope:this})},languageGetText:function(e){return SUGAR.language.get("KReports",e)},getRand:function(){return Math.random()},S4:function(){return(65536*(1+this.getRand())|0).toString(16).substring(1)},kGuid:function(){return"k"+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()},getReportId:function(){return this.reportRecord.get("id")}}),Ext.application({extend:"SpiceCRM.KReporter.Designer.Application"}),Ext.onReady(function(){});