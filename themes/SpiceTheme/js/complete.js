/* * *******************************************************************************
* This file is part of SpiceCRM FulltextSearch. SpiceCRM FulltextSearch is an enhancement developed
* by aac services k.s.. All rights are (c) 2016 by aac services k.s.
*
* This Version of the SpiceCRM FulltextSearch is licensed software and may only be used in
* alignment with the License Agreement received with this Software.
* This Software is copyrighted and may not be further distributed without
* witten consent of aac services k.s.
*
* You can contact us at info@spicecrm.io
******************************************************************************* */

var SpiceCRM=angular.module("SpiceCRM",[]);SpiceCRM.controller("FavoritesCtrl",["$scope","FavoritesService","UserConfigService",function(e,t,n){angular.extend(e,{favoritesWidget:{name:"Favorites",label:"Favorites",closed:!1,class:function(){return"true"!==n.objects.Favorites_collapsed?"open":"close"},isFavorite:function(){t.checkIsFavorite().then(function(e){return t.isFavorite},function(){$("#Favorites").hide()})},toggleFavorite:function(){t.isFavorite?t.delete_favorite():t.set_favorite()}},userConfigService:n,favoritesService:t})}]),SpiceCRM.directive("favoritesWidget",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/Favorites/template.html",controller:"FavoritesCtrl",replace:!0,scope:!1}}]),SpiceCRM.directive("favoritesItem",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/Favorites/entry.html",replace:!0,scope:{itemData:"="}}}]),SpiceCRM.factory("FavoritesService",["$http","UserConfigService","SessionStorageService","$q",function(a,e,s,o){var r={userConfigService:e,objects:[],loading:!1,isFavorite:!1,load:function(){var t=o.defer();r.loading=!0;var e=s.getParam("favoritesWidgetData");return!1===e||0===e.length?a({method:"GET",url:"KREST/theme/Favorites"}).success(function(e){t.resolve(e)}):(r.objects=s.getParam("favoritesWidgetData"),t.resolve(r.objects)),r.checkIsFavorite().then(function(){r.loading=!1}),t.promise},checkIsFavorite:function(){var t=o.defer(),e=$('form[name$="View"] input[name="module"]').val(),n=$('form[name$="View"] input[name="record"]').val(),i=!1;if(r.objects=s.getParam("favoritesWidgetData"),e&&n){if(0<r.objects.length)for(index=0;index<r.objects.length;++index)r.objects[index].item_id==n&&(i=!0);i?(r.isFavorite=i,t.resolve(i)):a({method:"GET",url:"KREST/theme/Favorites/"+e+"/"+n}).success(function(e){r.isFavorite=e.isFavorite,i=e.isFavorite,t.resolve(i)})}else t.reject();return t.promise},set_favorite:function(){var e=$('form[name$="View"] input[name="module"]').val(),t=$('form[name$="View"] input[name="record"]').val();if(e&&t){a({method:"POST",url:"KREST/theme/Favorites/"+e+"/"+t}).success(function(e){r.isFavorite=!0});var n={item_id:t,module_name:e,item_summary:$("#moduleTitleDummy h2").text(),item_summary_short:$("#moduleTitleDummy h2").text().substr(0,15)};r.objects.push(n),s.setParam("favoritesWidgetData",r.objects)}},delete_favorite:function(){var e=$('form[name$="View"] input[name="module"]').val(),t=$('form[name$="View"] input[name="record"]').val();if(e&&t)for(a({method:"DELETE",url:"KREST/theme/Favorites/"+e+"/"+t}).success(function(e){r.isFavorite=!1}),index=0;index<r.objects.length;++index)r.objects[index].item_id==t&&r.objects.splice(index,1)}};return r.userConfigService.load(),r.load().then(function(e){r.objects=e,s.setParam("favoritesWidgetData",e),r.loading=!1}),r}]),SpiceCRM.controller("LastViewedCtrl",["$scope","LastViewedService","UserConfigService",function(e,t,n){angular.extend(e,{lastViewedWidget:{name:"LastViewed",label:"Last Viewed",closed:!1,class:function(){return"true"!==n.objects.LastViewed_collapsed?"open":"close"}},userConfigService:n,lastViewedService:t})}]),SpiceCRM.directive("lastViewedWidget",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/LastViewed/template.html",controller:"LastViewedCtrl",replace:!0}}]),SpiceCRM.directive("lastViewedItem",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/LastViewed/entry.html",replace:!0,scope:{itemData:"="}}}]),SpiceCRM.factory("LastViewedService",["$http","UserConfigService","SessionStorageService",function(s,e,o){var r={userConfigService:e,objects:[],loading:!1,load:function(){if(!(r.loading=!0)===o.getParam("lastViewedWidgetData"))s({method:"GET",url:"KREST/theme/getLastViewed"}).success(function(e){r.objects=e,o.setParam("lastViewedWidgetData",e)});else if(r.objects=o.getParam("lastViewedWidgetData"),0<$('form[name="DetailView"]').length){var e,t=$("<textarea/>").html($(".moduleTitle h2").html()).text(),n={id:1,item_id:$('form[name="DetailView"] input[name="record"]').val(),item_summary:t,item_summary_short:t.substring(0,13)+"...",module_name:$('form[name="DetailView"] input[name="module"]').val()};if("object"==typeof r.objects){var i=[];for(var a in r.objects)r.objects.hasOwnProperty(a)&&i.push(r.objects[a]);r.objects=i}else r.objects=[];for(e=0;e<r.objects.length;++e)if(r.objects[e].item_id==n.item_id){!0;r.objects.splice(e,1)}r.objects.unshift(n),r.objects=r.objects.splice(0,10),o.setParam("lastViewedWidgetData",r.objects)}r.loading=!1}};return r.userConfigService.load(),r.load(),r}]),SpiceCRM.controller("shortcutsCtrl",["$scope","shortcutsService","UserConfigService",function(e,t,n){angular.extend(e,{shortcutsWidget:{name:"Shortcuts",label:"Shortcuts",closed:!1,class:function(){return"true"!==n.objects.Shortcuts_collapsed?"open":"close"}},userConfigService:n,shortcutsService:t})}]),SpiceCRM.directive("shortcutsWidget",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/Shortcuts/template.html",controller:"shortcutsCtrl",replace:!0}}]),SpiceCRM.directive("shortcutsItem",[function(){return{restrict:"E",templateUrl:"themes/SpiceTheme/js/Widgets/Shortcuts/entry.html",replace:!0,scope:{itemData:"="}}}]),SpiceCRM.factory("shortcutsService",["$http","$window","UserConfigService","SessionStorageService",function(e,n,t,i){var a={userConfigService:t,objects:[],loading:!1,load:function(){a.loading=!0;var t=i.getParam("shortcuts");!1===t||void 0===t[n.currentModule]?e({method:"GET",url:"KREST/theme/getShortcuts/"+n.currentModule}).success(function(e){a.objects=e,!1===t?(t={})[n.currentModule]=e:t[n.currentModule]=e,i.setParam("shortcuts",t)}):a.objects=t[n.currentModule],a.loading=!1}};return a.userConfigService.load(),a.load(),a}]),SpiceCRM.factory("SessionStorageService",["$window",function(i){var a={getParam:function(e){var t;return _session_name="PHPSESSID",void 0!==SUGAR.config.session_name&&(_session_name=SUGAR.config.session_name),void 0!==i.sessionStorage[a.readCookie(_session_name)]&&(t=angular.fromJson(i.sessionStorage[a.readCookie(_session_name)])),void 0!==t&&void 0!==t[e]&&t[e]},setParam:function(e,t){_session_name="PHPSESSID",void 0!==SUGAR.config.session_name&&(_session_name=SUGAR.config.session_name);var n=angular.fromJson(i.sessionStorage[a.readCookie(_session_name)]);void 0===n&&(n={}),n[e]=t,i.sessionStorage[a.readCookie(_session_name)]=angular.toJson(n)},readCookie:function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var a=n[i];" "==a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return a.substring(t.length,a.length)}return null}};return a}]),SpiceCRM.factory("UserConfigService",["$http","$window","SessionStorageService",function(t,n,i){var a={objects:[],load:function(){var e;!1===(e=i.getParam("userConfig"))?t({method:"GET",url:"KREST/theme/getConfig"}).success(function(e){a.objects=e,i.setParam("userConfig",e)}):a.objects=e},toggle:function(e,t){n.spicetheme.collapsedStatic[e]||!t?(n.spicetheme.collapsed[e]=!1,t&&(n.spicetheme.collapsedStatic[e]=!1,n.spicetheme.setToggle(!1,e),a.setParam(e,!1))):(n.spicetheme.collapsed[e]=!0,t&&(n.spicetheme.collapsedStatic[e]=!0,n.spicetheme.setToggle(!0,e),a.setParam(e,!0)))},setParam:function(e,t){a.objects[e+"_collapsed"]=t.toString(),i.setParam("userConfig",a.objects)}};return a}]),angular.module("SpiceCRM").run(["$templateCache",function(e){"use strict";e.put("themes/SpiceTheme/js/Widgets/Favorites/entry.html",'<li title="{{itemData.module_name}}: {{itemData.item_summary}}"><a href="index.php?module={{itemData.module_name}}&action=DetailView&record={{itemData.item_id}}"><span>{{itemData.item_summary_short}}</span></a><div class="moduleIcon"><img ng-src="themes/SpiceTheme/images/{{itemData.module_name}}.gif" onerror="this.src=\'include/images/blank.gif\'"></div><div class="changeIcon"><a title="{{itemData.module_name}}: {{itemData.item_summary}}" href="index.php?module={{itemData.module_name}}&action=EditView&record={{itemData.item_id}}"><img src="themes/SpiceTheme/images/edit_inline.gif"></a></div></li>'),e.put("themes/SpiceTheme/js/Widgets/Favorites/template.html",'<div id="{{favoritesWidget.name}}" class="shortcuts"><span class="shortcutstitle">{{favoritesWidget.label}}</span><div id="expand_{{favoritesWidget.name}}" class="expander" ng-click="userConfigService.toggle(favoritesWidget.name,true)"><span ng-show="userConfigService.objects.Favorites_collapsed == \'true\'" class="arrow_down"></span> <span ng-show="userConfigService.objects.Favorites_collapsed == \'false\'" class="arrow_up"></span></div><div ng-if="favoritesService.loading">loading...</div><div id="widget_cotent_{{favoritesWidget.name}}" ng-class="\'widget_content \'+favoritesWidget.class()" ng-if="!favoritesService.loading"><ul ng-show="userConfigService.objects.Favorites_collapsed == \'false\'"><favorites-item ng-repeat="object in favoritesService.objects" item-data="object"></favorites-item></ul></div></div>'),e.put("themes/SpiceTheme/js/Widgets/LastViewed/entry.html",'<li title="{{itemData.module_name}}: {{itemData.item_summary}}"><a href="index.php?module={{itemData.module_name}}&action=DetailView&record={{itemData.item_id}}"><span>{{itemData.item_summary_short}}</span></a><div class="moduleIcon"><img ng-src="themes/SpiceTheme/images/{{itemData.module_name}}.gif" onerror="this.src=\'include/images/blank.gif\'"></div><div class="changeIcon"><a title="{{itemData.module_name}}: {{itemData.item_summary}}" href="index.php?module={{itemData.module_name}}&action=EditView&record={{itemData.item_id}}"><img src="themes/SpiceTheme/images/edit_inline.gif"></a></div></li>'),e.put("themes/SpiceTheme/js/Widgets/LastViewed/template.html",'<div id="{{lastViewedWidget.name}}" class="shortcuts"><span class="shortcutstitle">{{lastViewedWidget.label}}</span><div id="expand_{{lastViewedWidget.name}}" class="expander" ng-click="userConfigService.toggle(lastViewedWidget.name,true)"><span ng-show="userConfigService.objects.LastViewed_collapsed == \'true\'" class="arrow_down"></span> <span ng-show="userConfigService.objects.LastViewed_collapsed == \'false\'" class="arrow_up"></span></div><div ng-if="lastViewedService.loading">loading...</div><div id="widget_cotent_{{lastViewedWidget.name}}" ng-class="\'widget_content \'+lastViewedWidget.class()" ng-if="!lastViewedService.loading"><ul ng-show="userConfigService.objects.LastViewed_collapsed == \'false\'"><last-viewed-item ng-repeat="object in lastViewedService.objects" item-data="object"></last-viewed-item></ul></div></div>'),e.put("themes/SpiceTheme/js/Widgets/Shortcuts/entry.html",'<li style="white-space:nowrap"><span ng-if="itemData.URL == \'\'">{{itemData.LABEL}}</span> <a ng-if="itemData.URL !== \'\'" href="{{itemData.URL}}"><span>{{itemData.LABEL}}</span></a></li>'),e.put("themes/SpiceTheme/js/Widgets/Shortcuts/template.html",'<div id="{{shortcutsWidget.name}}" class="shortcuts"><span class="shortcutstitle">{{shortcutsWidget.label}}</span><div id="expand_{{shortcutsWidget.name}}" class="expander" ng-click="userConfigService.toggle(shortcutsWidget.name,true)"><span ng-show="userConfigService.objects.Shortcuts_collapsed == \'true\'" class="arrow_down"></span> <span ng-show="userConfigService.objects.Shortcuts_collapsed == \'false\'" class="arrow_up"></span></div><div ng-if="shortcutsService.loading">loading...</div><div id="widget_cotent_{{shortcutsWidget.name}}" ng-class="\'widget_content \'+shortcutsWidget.class()" ng-if="!shortcutsService.loading"><ul ng-show="userConfigService.objects.Shortcuts_collapsed == \'false\'"><shortcuts-item ng-repeat="object in shortcutsService.objects" item-data="object"></shortcuts-item></ul></div></div>')}]),spicetheme={timedFunction:null,moreModulesCollapsed:!0,groupsCollapsed:!0,footerLineCollapsed:!0,collapsed:[],collapsedStatic:[],selectedGroup:"",menuStore:{},menuItemsStore:{},openItemMenu:null,openingItemMenu:null,currentMenuItem:null,errorcount:0,errorsdisplayed:!1,cpdisplayed:!1,currentEditedPage:null,toggleActivePage:function(e){window.location="index.php?module=Home&action=index&activePage="+e},addPage:function(){$("#pageEdit").insertBefore("#pageItem0"),document.getElementById("pageTitle").value="new Page",document.getElementById("pageColumns").value=2,document.getElementById("moduleTab_HomeMenu").style.display="none",document.getElementById("pageEdit").style.display="block",spicetheme.currentEditedPage="new"},editPage:function(e){$.ajax({url:"KREST/theme/Page/"+e,type:"GET",success:function(e){var t=JSON.parse(e);console.log(t),$("#pageEdit").insertAfter("#pageItem"+t.index),document.getElementById("pageTitle").value=t.pageTitle,document.getElementById("pageColumns").value=t.numColumns,0===t.index?document.getElementById("pageEditDeleteButton").style.display="none":document.getElementById("pageEditDeleteButton").style.display="inline",document.getElementById("pageEdit").style.display="block",spicetheme.currentEditedPage=t.index}})},cancelPageEdit:function(){document.getElementById("pageEdit").style.display="none",spicetheme.currentEditedPage=null},commitPageEdit:function(){$.ajax({url:"KREST/theme/Page/"+spicetheme.currentEditedPage,method:"POST",dataType:"json",data:{pageTitle:document.getElementById("pageTitle").value,pageColumns:document.getElementById("pageColumns").value},success:function(e){window.location="index.php?module=Home&action=index&activePage="+e}})},deletePage:function(){$.ajax({url:"KREST/theme/Page/"+spicetheme.currentEditedPage,type:"DELETE",dataType:"json",data:{pageTitle:document.getElementById("pageTitle").value,pageColumns:document.getElementById("pageColumns").value},success:function(e){window.location="index.php?module=Home&action=index"}})},resetPages:function(){$.ajax({url:"KREST/theme/Page/reset",type:"POST",success:function(e){window.location="index.php?module=Home&action=index"}})},toggleFavorite:function(){"0"==document.getElementById("beanisfavorite").value?(document.getElementById("beanisfavorite").value="1",document.getElementById("iafavoriteinactive").style.display="none",document.getElementById("iafavoriteactive").style.display="block"):(document.getElementById("beanisfavorite").value="0",document.getElementById("iafavoriteinactive").style.display="block",document.getElementById("iafavoriteactive").style.display="none");var e=document.getElementById("formDetailView");"1"==document.getElementById("beanisfavorite").value?$.ajax({url:"KREST/module/"+e.module.value+"/"+e.record.value+"/favorite",type:"POST",success:function(e){}}):$.ajax({url:"KREST/module/"+e.module.value+"/"+e.record.value+"/favorite",type:"DELETE",success:function(e){}})},toggleMoreModules:function(){this.moreModulesCollapsed?(document.getElementById("moreModuleItems").style.visibility="visible",this.moreModulesCollapsed=!1,$("#MoreModules").mouseleave(function(){document.getElementById("moreModuleItems").style.visibility="hidden",spicetheme.moreModulesCollapsed=!0})):(document.getElementById("moreModuleItems").style.visibility="hidden",this.moreModulesCollapsed=!0)},changeGroup:function(e){this.menuStore[document.getElementById("currentGroup").innerHTML]||(this.menuStore[document.getElementById("currentGroup").innerHTML]=document.getElementById("newSubmenu").innerHTML),document.getElementById("currentGroup").innerHTML=e,document.getElementById("newSubmenu").style.display="none",document.getElementById("newSubmenuloading").style.display="inline",this.menuStore[e]?(document.getElementById("newSubmenu").style.display="inline",document.getElementById("newSubmenuloading").style.display="none",document.getElementById("newSubmenu").innerHTML=this.menuStore[e],$(".newsubmenuitem").mouseenter(function(e){spicetheme.triggerItemMenu(e.currentTarget.id.replace("tab","").replace("moduleTab_","")),spicetheme.openingItemMenu=e.currentTarget.id.replace("tab","").replace("moduleTab_","")}),$(".newsubmenuitem").mouseleave(function(){$("#"+spicetheme.openItemMenu).remove(),spicetheme.openItemMenu=null,spicetheme.openingItemMenu=null})):$.ajax({url:"KREST/theme/changeGroup/"+document.getElementById("currentModule").innerHTML+"/"+e,type:"GET",dataType:"html",processData:!1,success:function(e){document.getElementById("newSubmenu").style.display="inline",document.getElementById("newSubmenuloading").style.display="none",document.getElementById("newSubmenu").innerHTML=e,$(".newsubmenuitem").mouseenter(function(e){spicetheme.triggerItemMenu(e.currentTarget.id.replace("tab","").replace("moduleTab_","")),spicetheme.openingItemMenu=e.currentTarget.id.replace("tab","").replace("moduleTab_","")}),$(".newsubmenuitem").mouseleave(function(){$("#"+spicetheme.openItemMenu).remove(),spicetheme.openItemMenu=null,spicetheme.openingItemMenu=null})}})},toggleGroups:function(){this.groupsCollapsed?(document.getElementById("tabGroupDropDown").style.visibility="visible",this.groupsCollapsed=!1,$("#groupdropdowntab").mouseleave(function(){document.getElementById("tabGroupDropDown").style.visibility="hidden",spicetheme.groupsCollapsed=!0})):(document.getElementById("tabGroupDropDown").style.visibility="hidden",this.groupsCollapsed=!0)},removeItemMenu:function(e){this.openItemMenu,0},triggerRemoveItemMenu:function(e){this.openItemMenu&&this.openItemMenu=="moduleTab_"+e+"Menu"&&(this.timedFunction=window.setTimeout("spicetheme.removeItemMenu('"+e+"')",300))},cancelRemoveItemMenu:function(){this.timedFunction&&(window.clearTimeout(this.timedFunction),this.timedFunction=null)},displayItemMenu:function(e){if(this.currentMenuItem==e&&0===$(".moduletabitemmenu").length&&spicetheme.openingItemMenu==e){var t=$("#"+e+"tab").offset(),n=document.createElement("div");n.id="moduleTab_"+e+"Menu",n.className="moduletabitemmenu",n.style.left=t.left+"px";var i=spicetheme.menuItemsStore[e];n.innerHTML=i.menu+i.lastviewed+i.favorites,document.getElementById(e+"tab").appendChild(n),this.openItemMenu=n.id,$(".newsubmenuitem").mouseleave(function(){$("#"+spicetheme.openItemMenu).remove(),spicetheme.openItemMenu=null})}},getItemMenu:function(t){this.menuItemsStore[t]?spicetheme.displayItemMenu(t):$.ajax({url:"KREST/theme/getMenu/"+currentModule+"/"+t,type:"GET",success:function(e){spicetheme.menuItemsStore[t]="object"==typeof e?e:JSON.parse(e),spicetheme.displayItemMenu(t)}})},triggerItemMenu:function(e){this.timedFunction=window.setTimeout("spicetheme.getItemMenu('"+e+"')",400),this.currentMenuItem=e},cancelLoadItemMenu:function(e){this.timedFunction&&(window.clearTimeout(this.timedFunction),this.timedFunction=null,this.currentMenuItem=null),this.triggerRemoveItemMenu(e)},getErrorCount:function(){errorCountArray=document.getElementById("errormessages").innerHTML.match(/<p class/g),errorCountArray&&(this.errorcount=errorCountArray.length,document.getElementById("errorcount").innerHTML=errorCountArray.length,document.getElementById("errorcountli").style.display="inline"),null!==document.getElementById("statistics")&&(document.getElementById("statistics").innerHTML=document.getElementById("responseTime").innerHTML)},closeCopyright:function(){document.getElementById("copyright").style.display="none",this.cpdisplayed=!1},displayCopyright:function(){this.cpdisplayed?(document.getElementById("copyright").style.display="none",this.cpdisplayed=!1):(cprightpos=$(document.getElementById("poweredbysugarcrm")).offset(),cprightpos.top=cprightpos.top-210,cprightpos.left=cprightpos.left,$(document.getElementById("copyright")).css(cprightpos),document.getElementById("copyright").style.display="inline",this.cpdisplayed=!0)},displayErrors:function(){this.errorsdisplayed?(document.getElementById("errormessages").style.display="none",this.errorsdisplayed=!1):(errorcountpos=$(document.getElementById("errorcount")).offset(),errorcountpos.top=errorcountpos.top-(30*this.errorcount+30),errorcountpos.left=errorcountpos.left,$(document.getElementById("errormessages")).css(errorcountpos),$(document.getElementById("errormessages")).css("height","auto"),document.getElementById("errormessages").style.display="inline",this.errorsdisplayed=!0)},hideActionButtons:function(){document.getElementById("actionmenu").appendChild(document.getElementById("SAVE_HEADER"))},hijackActionMenu:function(){$(".SugarActionMenu").each(function(){var e=$(this).children("li").children("ul").children("li");$(this).append(e)})},hijackModuleTitle:function(){"undefined"!=typeof action_sugar_grp1?"DetailView"!=action_sugar_grp1&&$("#itemactions").css("display","none"):$("#itemactions").css("display","none"),elements=$(".moduleTitle"),0<elements.length&&($("#moduleTitleDummy").addClass("moduleTitle"),$("#moduleTitleDummy").show(),$("#moduleTitleDummy").html($(elements[0]).html()))},registerEvents:function(){$(document).click(function(e){"copyright"!=e.target.id&&"poweredbysugarcrm"!=e.target.id&&spicetheme.cpdisplayed&&(document.getElementById("copyright").style.display="none",spicetheme.cpdisplayed=!1),"errormessages"!=e.target.id&&"errormessages"!=e.target.parentNode.id&&"errorcount"!=e.target.id&&spicetheme.errorsdisplayed&&(document.getElementById("errormessages").style.display="none",spicetheme.errorsdisplayed=!1)}),$(".newsubmenuitem").mouseenter(function(e){spicetheme.triggerItemMenu(e.currentTarget.id.replace("tab","").replace("moduleTab_","")),spicetheme.openingItemMenu=e.currentTarget.id.replace("tab","").replace("moduleTab_","")}),$(".newsubmenuitem").mouseleave(function(){$("#"+spicetheme.openItemMenu).remove(),spicetheme.openItemMenu=null,spicetheme.openingItemMenu=null}),null!==document.getElementById("iareminder")&&($("#iareminder").click(function(){$("#iareminderpicker").show()}),$("#iaremindernew").click(function(){$("#iareminderpicker").show()}),$("#iareminderremove").click(function(){spicetheme.removeReminder()})),$("#SpiceSideBar").sortable({items:"div.shortcuts",distance:15,axis:"y",opacity:.8,cursorAt:{left:5},revert:!0,update:function(e,t){spicetheme.sortSave()}}),$("#SpiceSideBar div.shortcuts span.shortcutstitle").css("cursor","move"),$("#SpiceSideBar").disableSelection(),"undefined"!=typeof action_sugar_grp1&&"undefined"!=typeof subpanelsTabbed&&"DetailView"==action_sugar_grp1&&subpanelsTabbed&&0===$("#groupTabs").length&&spicetheme.subpanelsTabbed()},setDatepicker:function(){"undefined"!=typeof action_sugar_grp1&&null!==document.getElementById("iareminderpicker")&&"DetailView"==action_sugar_grp1&&($("#iareminderpicker").datepicker({dateFormat:cal_date_format.replace(/\%/g,"").replace("Y","yy").replace("m","mm").replace("d","dd"),defaultDate:$("#iareminder").html(),numberOfMonths:2,onSelect:function(e,t){document.getElementById("iareminder").innerHTML=e;var n=document.getElementById("formDetailView");$.ajax({url:"KREST/module/"+n.module.value+"/"+n.record.value+"/reminder",type:"POST",dataType:"html",processData:!1,data:JSON.stringify({reminderDate:e}),success:function(e){$("#widget_cotent_Reminders").html(e),$("#combo_Reminders").html(e)}}),$("#iareminderpicker").hide(),$("#iareminderremove").css("display","inline"),$("#iaremindernew").css("display","none")}}).hide(),""!==$("#iareminder").html()?$("#iareminderremove").css("display","inline"):$("#iaremindernew").css("display","inline"))},removeReminderById:function(e){var t=document.getElementById("formDetailView");$.ajax({url:"KREST/module/"+t.module.value+"/"+e+"/reminder",type:"DELETE",dataType:"html",success:function(e){$("#widget_cotent_Reminders").html(e),$("#combo_Reminders").html(e)}}),void 0!==t&&t.record.value==e&&($("#iareminderremove").css("display","none"),$("#iaremindernew").css("display","inline"),document.getElementById("iareminder").innerHTML="")},removeReminder:function(){$("#iareminderpicker").hide();var e=document.getElementById("formDetailView");$.ajax({url:"KREST/module/"+e.module.value+"/"+e.record.value+"/reminder",type:"DELETE",dataType:"html",success:function(e){$("#widget_cotent_Reminders").html(e),$("#combo_Reminders").html(e)}}),$("#iareminderremove").css("display","none"),$("#iaremindernew").css("display","inline"),document.getElementById("iareminder").innerHTML="",$("#iareminderpicker").datepicker.defaultDate=""},toggleFooterline:function(e,t){this.footerLineCollapsedStatic||!e?(!1===t?($("#footerline").css("width","100%"),$("#expand_footerline span").removeClass("arrow_right"),$("#expand_footerline span").addClass("arrow_left"),$("#welcome_slide").removeAttr("style"),spicetheme.getErrorCount()):($("#footerline").animate({width:"100%"},1e3),setTimeout(function(){$("#expand_footerline span").removeClass("arrow_right"),$("#expand_footerline span").addClass("arrow_left"),$("#welcome_slide").fadeIn(),spicetheme.getErrorCount()},600)),this.footerLineCollapsed=!1,e&&(this.footerLineCollapsedStatic=!1,this.setToggleFooterline(!1))):($("#expand_footerline span").removeClass("arrow_left"),$("#expand_footerline span").addClass("arrow_right"),$("#welcome_slide").fadeOut(),$("#footerline").animate({width:"165px"},1e3),this.footerLineCollapsed=!0,e&&(this.footerLineCollapsedStatic=!0,this.setToggleFooterline(!0)))},toggleFooterline_mouseover:function(e){this.footerLineCollapsedStatic&&(this.footerLineCollapsed="mousein"==e?($("#footerline").animate({width:"100%"},500),setTimeout(function(){$("#welcome_slide").fadeIn()},200),!1):($("#welcome_slide").fadeOut("fast"),setTimeout(function(){$("#footerline").animate({width:"165px"},500)},200),!0))},setToggleFooterline:function(e){$.ajax({url:"KREST/theme/setToggleFooterline",type:"POST",dataType:"json",processData:!1,data:JSON.stringify({footerLineCollapsed:e}),success:function(e){}})},toggle:function(item,save,animated){this.collapsedStatic[item]||!save?(!1===load_closed&&0===$("#"+item+" ul").length&&save&&$.ajax({url:"KREST/theme/refresh/"+currentModule+"/"+item,type:"GET",success:function(result){if(result=result,$("#"+item+" div.widget_content").append(result.content),0<result.jsinclude.length&&$('head [src="'+result.jsinclude+'"]').length<1){var snode=document.createElement("script");snode.setAttribute("type","text/javascript"),snode.setAttribute("src",result.jsinclude),document.getElementsByTagName("head")[0].appendChild(snode)}0<result.jsexecute.length&&eval(result.jsexecute)}}),!1===animated?($("#expand_"+item+" span").removeClass("arrow_down"),$("#expand_"+item+" span").addClass("arrow_up"),$("#"+item+" div.widget_content").addClass("style")):($("#expand_"+item+" span").removeClass("arrow_down"),$("#expand_"+item+" span").addClass("arrow_up"),$("#"+item+" div.widget_content").removeClass("close"),$("#"+item+" div.widget_content").addClass("open")),this.collapsed[item]=!1,save&&(this.collapsedStatic[item]=!1,this.setToggle(!1,item))):($("#expand_"+item+" span").removeClass("arrow_up"),$("#expand_"+item+" span").addClass("arrow_down"),$("#"+item+" div.widget_content").removeClass("open"),$("#"+item+" div.widget_content").addClass("close"),this.collapsed[item]=!0,save&&(this.collapsedStatic[item]=!0,this.setToggle(!0,item)))},toggleSideBar:function(e,t){var n="SideBar";this.collapsedStatic[n]||!e?(!1===t?($("#leftBar").css("left","0px"),$("#SideBarExpander_arrow").removeClass("arrow_right"),$("#SideBarExpander_arrow").addClass("arrow_left"),$("div#content").css("margin-left","175px")):($("#leftBar").removeClass("hide"),$("div#content").removeClass("sidebar_closed"),$("#leftBar").addClass("show"),$("div#content").addClass("sidebar_open"),setTimeout(function(){$("#SideBarExpander_arrow").removeClass("arrow_right"),$("#SideBarExpander_arrow").addClass("arrow_left")},600)),this.collapsed[n]=!1,e&&(this.collapsedStatic[n]=!1,this.setToggle(!1,n))):($("#SideBarExpander_arrow").removeClass("arrow_left"),$("#SideBarExpander_arrow").addClass("arrow_right"),$("#leftBar").removeClass("show"),$("div#content").removeClass("sidebar_open"),$("#leftBar").addClass("hide"),$("div#content").addClass("sidebar_closed"),this.collapsed[n]=!0,e&&(this.collapsedStatic[n]=!0,this.setToggle(!0,n)))},toggleSideBar_mouseover:function(e){var t="SideBar";this.collapsedStatic[t]&&("mousein"==e&&this.collapsed[t]?($("#leftBar").removeClass("hide"),$("#leftBar").addClass("show"),$(".leftbar").css("border-right-width","1px"),this.collapsed[t]=!1,this.timedFunction=null):($("#leftBar").removeClass("show"),$("#leftBar").addClass("hide"),$(".leftbar").css("border-right-width","15px"),this.collapsed[t]=!0))},triggerSideBar:function(e){this.timedFunction=window.setTimeout("spicetheme.toggleSideBar_mouseover('"+e+"')",400)},cancelSideBar:function(e){this.timedFunction?(window.clearTimeout(this.timedFunction),this.timedFunction=null):spicetheme.toggleSideBar_mouseover(e)},getToggle:function(e){!0!==toggled[e]?("SideBar"==e?spicetheme.toggleSideBar(!1,!1):spicetheme.toggle(e,!1,!1),spicetheme.collapsedStatic[e]=!1):spicetheme.collapsedStatic[e]=!0},setToggle:function(e,t){$.ajax({url:"KREST/theme/setToggle/"+t+"/"+e,type:"GET",success:function(e){}})},sortSave:function(){var e="";$("#leftBar div.shortcuts:not(#actionmenu)").each(function(){e+=this.id+","}),$.ajax({url:"KREST/theme/saveSort",type:"POST",dataType:"json",processData:!1,data:JSON.stringify({order:e}),success:function(e){}})},showConfigSideBar:function(){$.ajax({url:"KREST/theme/showConfigSideBar",processData:!1,dataType:"html",success:function(e){$("body").append('<div id="config_sidebar_dialog">'+e+"</div>"),$("#config_sidebar_dialog").dialog({modal:!0,buttons:{Save:function(){var e="";$("#config_sidebar_dialog input:checked").each(function(){e+=$(this).attr("name")+","}),$.ajax({url:"KREST/theme/setWidgetUserConfig",type:"POST",dataType:"json",processData:!1,data:JSON.stringify({param:"SpiceThemeSideBarConfig",value:e}),success:function(e){location.reload()}})},Cancel:function(){$(this).dialog("close")}}})}})},subpanelsTabbed:function(){var i=1;$("#subpanel_list li").hide(),$("#subpanel_list").before('<ul id="subpanels_tabbed_list" class="subpanelTablist" />'),$('#subpanel_list li[id^="whole_subpanel_"]').each(function(){$this=$(this);var e=$("#subpanel_list li#"+this.id+' div[id^="subpanel_title_"] h3 > span').text().trim(),t=this.id.split("whole_subpanel_")[1],n=document.createElement("li");n.id="subpanelTabbed_"+t,n.title=t,n.style.cursor="pointer",$(n).append('<a href="#">'+e+"</a>"),$(n).hover(function(){$("#whole_subpanel_"+this.title).show(),$('#subpanel_list li[id!="whole_subpanel_'+this.title+'"]').hide(),$("#subpanels_tabbed_list li a.current").removeClass("current"),$(this).children("a").addClass("current")},function(){}),1==i&&($("#whole_subpanel_"+n.title).show(),$(n).children("a").addClass("current")),$("#subpanels_tabbed_list").append(n),i++});var e=document.createElement("li");e.id="subpanelTabbed_all",e.title="all",e.style.cursor="pointer",$(e).append('<a href="#">All</a>'),$(e).hover(function(){$("#subpanel_list li").show(),$("#subpanels_tabbed_list li a.current").removeClass("current"),$(this).children("a").addClass("current")},function(){}),$("#subpanels_tabbed_list").append(e)},initialize:function(){this.getErrorCount(),this.hijackModuleTitle(),this.registerEvents(),this.setDatepicker()},displayLogin:function(e){$("body").html(e),$('#form input[name="login_module"]').val(currentModule),$('#form input[name="login_record"]').val(currentRecord),$('#form input[name="login_action"]').val(currentAction)},displayGlobalLinksSubMenu:function(e){$("#"+e+"_submenu").show(),$("#"+e+"_submenu").offset({left:$("#"+e+"_link").offset().left-5,top:$("#"+e+"_link").offset().top-$("#"+e+"_submenu").height()-18})},quickNotes:{quickNotesCount:0,quickNotesLoaded:!1,filtered:!1,open:!1,displayQuickNotes:function(){spicetheme.quickNotes.open?($("#ianotes_container").fadeOut(),spicetheme.quickNotes.open=!1):(spicetheme.quickNotes.quickNotesCount<1&&$("#ianotes_new_container").slideDown(),spicetheme.quickNotes.quickNotesLoaded?$("#ianotes_container").fadeIn():$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/note",type:"GET",success:function(e){var t=e;if(0<t.length){for(var n=0;n<t.length;n++){var i=document.createElement("li");i.id=t[n].id,"1"==t[n].global&&(i.className="ianotes_global");var a=document.createElement("span");if(a.className="ianotes_title",a.innerHTML=t[n].user_name+", "+t[n].date,"1"==t[n].own){var s=document.createElement("img");s.src="themes/SpiceTheme/images/Trash.png",s.className="ianotes_delete",s.title="delete",s.onclick=function(){spicetheme.quickNotes.deleteQuickNote(this.parentNode.id),$(this).parent().remove()}}var o=document.createElement("div");o.id=t[n].id+"_text",o.innerHTML=t[n].text,"1"==t[n].own&&(o.title="click to edit",o.onclick=function(){spicetheme.quickNotes.editQuickNote(this.id)}),$(i).append(o),$(i).prepend(a),"1"==t[n].own&&$(i).prepend(s),$("#ianotes_container ul").append(i)}$("#ianotes_new_container").slideUp(),spicetheme.quickNotes.quickNotesLoaded=!0}else spicetheme.quickNotes.quickNotesLoaded=!0,$("#ianotes_new_container").slideDown();$("#ianotes_header_title").html("QuickNotes for "+$("#leftBar div.moduleTitle h2").text().trim()),$("#ianotes_container").fadeIn()}}),spicetheme.quickNotes.open=!0)},filterQuickNotes:function(){spicetheme.quickNotes.filtered?($("#ianotes_container li.ianotes_global:not(#ianotes_new_container)").show(),spicetheme.quickNotes.filtered=!1):($("#ianotes_container li.ianotes_global:not(#ianotes_new_container)").hide(),spicetheme.quickNotes.filtered=!0)},setQuickNoteIcon:function(){0===spicetheme.quickNotes.quickNotesCount?(document.getElementById("ianotesinactive").style.display="block",document.getElementById("ianotesactive").style.display="none"):(document.getElementById("ianotesinactive").style.display="none",document.getElementById("ianotesactive").style.display="block")},saveQuickNote:function(){$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/note",dataType:"json",processData:!1,data:JSON.stringify({text:document.forms.ianotes_new.text.value,global:$('#ianotes_new input[name="global"]:checked').length}),type:"POST",success:function(e){var t=e,n=document.createElement("li");n.id=t[0].id,"1"==t[0].global&&($("#ianotes_new_container").removeClass("ianotes_global"),n.className="ianotes_global");var i=document.createElement("span");i.className="ianotes_title",i.innerHTML=t[0].user_name+", "+t[0].date;var a=document.createElement("img");a.src="themes/SpiceTheme/images/Trash.png",a.className="ianotes_delete",a.title="delete",a.onclick=function(){spicetheme.quickNotes.deleteQuickNote(this.parentNode.id),$(this).parent().remove()};var s=document.createElement("div");s.id=t[0].id+"_text",s.innerHTML=t[0].text,s.title="click to edit",s.onclick=function(){arguments[0].originalTarget==this&&spicetheme.quickNotes.editQuickNote(this.id)},$(n).append(s),$(n).prepend(i),$(n).prepend(a),$("#ianotes_new_container").hide(),$("#ianotes_new textarea").val(""),$("#ianotes_new textarea").text(""),$("#ianotes_new textarea").html(""),$('#ianotes_new input[name="global"]').removeAttr("checked"),$("#ianotes_new_container").after(n),spicetheme.quickNotes.quickNotesCount++,spicetheme.quickNotes.setQuickNoteIcon()}})},editQuickNote:function(e){$("#"+e).hide();var t=$("#"+e).parent().attr("id");$("#"+t+" img#ianotes_delete").hide();var n=document.createElement("form");n.className="action_buttons",n.method="POST",n.action="#",n.id=t+"_form";var i=document.createElement("textarea");i.rows="4",i.id=t+"_edittext",i.innerHTML=$("#"+t+"_text").text();var a=document.createElement("label");a.style.verticalAlign="bottom",a.innerHTML="global Note:";var s=document.createElement("input");s.id=t+"_global",s.type="checkbox",s.value="1",$("#"+t).hasClass("ianotes_global")&&$(s).attr("checked","checked"),s.onclick=function(){$("#"+t).toggleClass("ianotes_global")};var o=document.createElement("input");o.className="button",o.type="reset",o.value="cancel",o.onclick=function(){spicetheme.quickNotes.abortEditQuickNote($(this).parent().parent().attr("id"))};var r=document.createElement("input");r.className="button",r.type="button",r.value="save",r.onclick=function(){return spicetheme.quickNotes.saveEditQuickNote($(this).parent().parent().attr("id")),!1},$(n).append(i),$(n).append("<br>"),$(n).append(a),$(n).append("&nbsp;"),$(n).append(s),$(n).append("&nbsp;"),$(n).append(o),$(n).append("&nbsp;"),$(n).append(r),$("#"+t).append(n)},saveEditQuickNote:function(e){$("#"+e+"_form").hide(),$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/note/"+e,dataType:"json",processData:!1,data:JSON.stringify({text:$("#"+e+"_edittext").val(),global:$("#"+e+"_global:checked").length}),type:"POST",success:function(e){}}),$("#"+e+"_text").html(spicetheme.quickNotes.nl2br($("#"+e+"_edittext").val(),!1)),$("#"+e+"_form").remove(),$("#"+e+"_text").show(),$("#"+e+" img#ianotes_delete").removeAttr("style")},abortEditQuickNote:function(e){$("#"+e+"_form").remove(),$("#"+e+"_text").show(),$("#"+e+" img#ianotes_delete").removeAttr("style")},deleteQuickNote:function(e){$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/note/"+e,type:"DELETE",success:function(e){spicetheme.quickNotes.quickNotesCount--,spicetheme.quickNotes.setQuickNoteIcon(),spicetheme.quickNotes.quickNotesCount<1&&($("#ianotes_new_container").slideDown(),$("#ianotes_container").fadeOut(),spicetheme.quickNotes.open=!1)}})},formClose:function(){spicetheme.quickNotes.quickNotesCount<1&&($("#ianotes_container").fadeOut(),spicetheme.quickNotes.open=!1),$("#ianotes_new_container").slideUp()},nl2br:function(e,t){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(t||void 0===t?"<br />":"<br>")+"$2")}},attachments:{attachmentsCount:0,attachmentsLoaded:!1,filtered:!1,open:!1,file:!1,formdata:!1,displayAttachments:function(){spicetheme.attachments.open?($("#iaattachments_container").fadeOut(),spicetheme.attachments.open=!1):(spicetheme.attachments.attachmentsCount<1&&$("#iaattachments_new_container").slideDown(),spicetheme.attachments.attachmentsLoaded?$("#iaattachments_container").fadeIn():$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/attachment/ui",type:"GET",success:function(e){var t=e;if(0<t.length){for(var n=0;n<t.length;n++){var i=document.createElement("li");i.id=t[n].id;var a=document.createElement("span");a.className="iaattachments_title",a.innerHTML=t[n].user_name+", "+t[n].date;var s=document.createElement("img");s.src="themes/SpiceTheme/images/Trash.png",s.className="iaattachments_delete",s.title="delete",s.onclick=function(){spicetheme.attachments.deleteAttachment(this.parentNode.id),$(this).parent().remove()};var o=document.createElement("div");o.id=t[n].id+"_text",o.innerHTML='<a href="'+t[n].url+'">'+t[n].filename+"</a><br>"+t[n].text,$(i).append(o),$(i).prepend(a),$(i).prepend(s),$("#iaattachments_container ul").append(i)}$("#iaattachments_new_container").slideUp(),spicetheme.attachments.attachmentsLoaded=!0}else spicetheme.attachments.attachmentsLoaded=!0,$("#iaattachments_new_container").slideDown();$("#iaattachments_header_title").html("Attachments for "+$("#leftBar div.moduleTitle h2").text().trim()),$("#iaattachments_container").fadeIn()}}),spicetheme.attachments.open=!0)},filterAttachments:function(){spicetheme.attachments.filtered?($("#iaattachments_container li.iaattachments_global:not(#iaattachments_new_container)").show(),spicetheme.attachments.filtered=!1):($("#iaattachments_container li.iaattachments_global:not(#iaattachments_new_container)").hide(),spicetheme.attachments.filtered=!0)},setAttachmentIcon:function(){0===spicetheme.attachments.attachmentsCount?(document.getElementById("iaattachmentsinactive").style.display="block",document.getElementById("iaattachmentsactive").style.display="none",$("#iaattachmentscount").html("")):(document.getElementById("iaattachmentsinactive").style.display="none",document.getElementById("iaattachmentsactive").style.display="block",$("#iaattachmentscount").html(spicetheme.attachments.attachmentsCount))},saveAttachment:function(){return spicetheme.attachments.formdata=new FormData,0<$("#iaattachments_new #iaattachments_new_file")[0].files.length&&spicetheme.attachments.formdata.append("file",$("#iaattachments_new #iaattachments_new_file")[0].files[0],$("#iaattachments_new #iaattachments_new_file")[0].files[0].name),!1!==spicetheme.attachments.file&&spicetheme.attachments.formdata.append("file",spicetheme.attachments.file,spicetheme.attachments.file.name),spicetheme.attachments.formdata.append("text",$("#iaattachments_new #iaattachments_new_text").val()),$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/attachment/ui",processData:!1,contentType:!1,data:spicetheme.attachments.formdata,type:"POST",success:function(e){var t=e,n=document.createElement("li");n.id=t[0].id;var i=document.createElement("span");i.className="iaattachments_title",i.innerHTML=t[0].user_name+", "+t[0].date;var a=document.createElement("img");a.src="themes/SpiceTheme/images/Trash.png",a.className="iaattachments_delete",a.title="delete",a.onclick=function(){spicetheme.attachments.deleteAttachment(this.parentNode.id),$(this).parent().remove()};var s=document.createElement("div");s.id=t[0].id+"_text",s.innerHTML='<a href="'+t[0].url+'">'+t[0].filename+"</a><br>"+t[0].text,$(n).append(s),$(n).prepend(i),$(n).prepend(a),$("#iaattachments_new_container").hide(),$("#iaattachments_new textarea").val(""),$("#iaattachments_new textarea").text(""),$("#iaattachments_new textarea").html(""),$("#iaattachments_new_container").after(n),$("#iaattachments_new_drop").removeClass("dropactive"),$("#iaattachments_new_list div").remove(),$("#iaattachments_new_status").show(),$("#iaattachments_new_drop").show(),spicetheme.attachments.attachmentsCount++,spicetheme.attachments.setAttachmentIcon()}}),!1},deleteAttachment:function(e){$.ajax({url:"KREST/module/"+currentModule+"/"+document.forms.DetailView.record.value+"/attachment/"+e,type:"DELETE",success:function(e){spicetheme.attachments.attachmentsCount--,$("#iaattachmentscount").html(spicetheme.attachments.attachmentsCount),spicetheme.attachments.setAttachmentIcon(),spicetheme.attachments.attachmentsCount<1&&($("#iaattachments_new_container").slideDown(),$("#iaattachments_container").fadeOut(),spicetheme.attachments.open=!1,$("#iaattachmentscount").html(""))}})},formClose:function(){spicetheme.attachments.attachmentsCount<1&&($("#iaattachments_container").fadeOut(),spicetheme.attachments.open=!1),$("#iaattachments_new_container").slideUp(),$("#iaattachments_new textarea").val(""),$("#iaattachments_new textarea").text(""),$("#iaattachments_new textarea").html(""),$("#iaattachments_new_drop").removeClass("dropactive"),$("#iaattachments_new_list div").remove(),$("#iaattachments_new_status").show(),$("#iaattachments_new_drop").show()},nl2br:function(e,t){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(t||void 0===t?"<br />":"<br>")+"$2")}}},$(function(){function c(e,t,n){e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)}$.ajaxSetup({error:function(e,t){401===e.status?location.reload():(console.log("Uncaught Error: "+t+"\nDetails:"+arguments[2].message+"\nResponse:"+e.responseText),console.log(e))}}),window.FileReader?($("#iaattachments_new_file").hide(),$("#iaattachments_new_status").click(function(){$("#iaattachments_new_file").trigger("click")}),Function.prototype.bindToEventHandler=function(){var t=this,n=Array.prototype.slice.call(arguments);return function(e){e=e||window.event,n.unshift(e),t.apply(this,n)}},c(window,"load",function(){var s=document.getElementById("iaattachments_new_status"),o=document.getElementById("iaattachments_new_drop"),r=document.getElementById("iaattachments_new_list");function e(e){return e.preventDefault&&e.preventDefault(),$("#iaattachments_new_drop").addClass("dropactive"),!1}function t(e){return e.preventDefault&&e.preventDefault(),$("#iaattachments_new_drop").removeClass("dropactive"),!1}function n(e){return e.preventDefault&&e.preventDefault(),!1===spicetheme.attachments.open&&spicetheme.attachments.displayAttachments(),$("#iaattachments_new_container").slideDown(),$("#iaattachments_new_drop").addClass("dropactive"),!1}c(o,"dragstart",e),c(o,"dragover",e),c(o,"dragenter",e),c(window,"dragstart",n),c(window,"dragover",n),c(window,"dragenter",n),c(o,"dragleave",t),c(o,"dragend",t),c(window,"dragleave",t),c(window,"dragend",t),c(o,"drop",function(e){if((e=e||window.event).preventDefault&&e.preventDefault(),1==r.getElementsByTagName("div").length)return!1;for(var t=e.dataTransfer.files,n=0;n<t.length;n++){var i=t[n],a=new FileReader;c(a,"loadend",function(e,t){this.result;var n=document.createElement("div");n.innerHTML="Loaded : "+t.name+" size "+t.size+" B",r.appendChild(n);r.getElementsByTagName("div").length;document.getElementById("iaattachments_new_file").files[0]=t,spicetheme.attachments.file=t,$(o).hide(),$(s).hide()}.bindToEventHandler(i)),a.readAsDataURL(i)}return!1})})):($("#iaattachments_new_file").show(),$("#iaattachments_new_status").hide(),$("#iaattachments_new_drop").hide(),$("#iaattachments_new_list").hide())});